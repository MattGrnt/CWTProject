<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Cancer waiting times projections over the parliamentary term</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="Cancer waiting times - Health Foundation code presentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/quarto.js"></script>
<script src="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/popper.min.js"></script>
<script src="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Cancer waiting times - Health Foundation code presentation_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Cancer waiting times - Health Foundation code presentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Cancer waiting times - Health Foundation code presentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Cancer waiting times - Health Foundation code presentation_files/libs/bootstrap/bootstrap-15cc5259c92eef6110fa5aafba6c7a61.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><link href="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/plotly-binding-4.10.4/plotly.js"></script><script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/typedarray-0.1/typedarray.min.js"></script><script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/jquery-3.5.1/jquery.min.js"></script><link href="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="Cancer%20waiting%20times%20-%20Health%20Foundation%20code%20presentation_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#project-aims" id="toc-project-aims" class="nav-link active" data-scroll-target="#project-aims">Project aims</a></li>
  <li><a href="#urgent-cancer-referrals" id="toc-urgent-cancer-referrals" class="nav-link" data-scroll-target="#urgent-cancer-referrals">Urgent cancer referrals</a></li>
  <li><a href="#day-waits" id="toc-day-waits" class="nav-link" data-scroll-target="#day-waits">31 day waits</a></li>
  <li><a href="#day-wait" id="toc-day-wait" class="nav-link" data-scroll-target="#day-wait">62 day wait</a></li>
  <li><a href="#what-would-i-do-differently" id="toc-what-would-i-do-differently" class="nav-link" data-scroll-target="#what-would-i-do-differently">What would I do differently?</a></li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Cancer waiting times projections over the parliamentary term</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>• A brief explanation of what problem you are trying to solve and the data you have used</p>
<p>• The approach you have taken to solving the problem Linear regression models to make predictions on patient volumes over the next 5 years. Ran different 3 different models with different start dates to get best estimates, ultimately settling on the model that used all available historical data. There was some debate about using more recent models, but it seemed likely they overinterpreted some recent trends. • What you learned in this project from an analysis and coding perspective One of my big learnings was to always keep in mind what the goal for a piece of work is. For this, the goal was to warn about potential problems in cancer care if nothing changed. The goal wasn’t to model the best predictions for what will happen in the next five years. • Reflections on what you would do differently in another project I would still have liked to explore a more robust modelling approach to this piece, maybe a general additive model so that we could build in some degree of plateau to the predictions, but time wasn’t available to do that - especially after the poisson model we were using didn’t seem to produce reliable results.</p>
<section id="project-aims" class="level2"><h2 class="anchored" data-anchor-id="project-aims">Project aims</h2>
<p>This code was part of a project to model cancer waiting times over the next parliamentary term, during the run up to the general election with the aim of landing a high profile press story to help keep cancer high on the policy agenda, and support other influencing work.</p>
<p>In line with this aim, there were three key pieces of information to generate:</p>
<ol type="1">
<li>Number of urgent cancer referrals being made - tracked by NHS England as urgent suspected cancer referrals</li>
<li>Number of people starting treatment - tracked by NHS England with their 31 day wait metric</li>
<li>How many won’t start their treatment within the NHS England target window - tracked via the NHS England 62 day wait metric</li>
</ol>
<p>Across all 3 metrics I used guassian linear regression modelling</p>
<div class="cell">
<details open="" class="code-fold"><summary>Libraries used</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/">rms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>rounding function</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CRUKRoundingPerYear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">number</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># number &lt;- 10050000</span></span>
<span>  <span class="va">number</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">1000000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000000</span> <span class="op">==</span> <span class="fl">500</span> <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span>  <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">100000</span><span class="op">)</span>  <span class="op">*</span> <span class="fl">100000</span>  <span class="op">==</span> <span class="fl">500</span> <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span>  <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span>   <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span>   <span class="op">*</span> <span class="fl">10000</span>   <span class="op">==</span> <span class="fl">500</span> <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span>   <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span>    <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span>    <span class="op">*</span> <span class="fl">1000</span>    <span class="op">==</span> <span class="fl">500</span> <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span>    <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000</span>     <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>     <span class="op">*</span> <span class="fl">100</span>     <span class="op">==</span> <span class="fl">50</span>  <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000</span>     <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000</span>      <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>     <span class="op">*</span> <span class="fl">100</span>     <span class="op">==</span> <span class="fl">50</span>  <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000</span>      <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100</span>       <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span>      <span class="op">*</span> <span class="fl">10</span>      <span class="op">==</span> <span class="fl">5</span>   <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">0.01</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100</span>       <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10</span>        <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span> <span class="op">/</span> <span class="fl">1</span><span class="op">)</span>       <span class="op">*</span> <span class="fl">1</span>       <span class="op">==</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="va">number</span> <span class="op">+</span> <span class="fl">0.0001</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10</span>        <span class="op">~</span> <span class="va">number</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">numbertext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000000</span> <span class="op">&gt;=</span> <span class="fl">900</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000000</span> <span class="op">&gt;=</span> <span class="fl">700</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"nearly "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000000</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"more than "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>,    <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span> <span class="op">&gt;=</span> <span class="fl">900</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span> <span class="op">&gt;=</span> <span class="fl">700</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"nearly "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"more than "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">*</span><span class="fl">100000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">*</span><span class="fl">10000</span> <span class="op">&gt;=</span> <span class="fl">900</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">*</span><span class="fl">10000</span> <span class="op">&gt;=</span> <span class="fl">700</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"nearly "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">*</span><span class="fl">10000</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"more than "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">*</span><span class="fl">10000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">*</span><span class="fl">10000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span> <span class="op">&gt;=</span> <span class="fl">900</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span> <span class="op">&gt;=</span> <span class="fl">700</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"nearly "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">number</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span> <span class="op">&amp;</span> <span class="va">number</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"more than "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                               big.mark<span class="op">=</span><span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, big.mark<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">1000</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, big.mark<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">~</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">number</span><span class="op">/</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">7.5</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around 10"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="va">number</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"around 5"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"less than 5"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">numbertext</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="urgent-cancer-referrals" class="level2"><h2 class="anchored" data-anchor-id="urgent-cancer-referrals">Urgent cancer referrals</h2>
<p>The dataset for this came directly from NHS England and didn’t need much cleaning. I initially did a few different models with different start dates</p>
<div class="cell">
<details class="code-fold"><summary>code for modelling</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CWTUSC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"data/CWT-CRS-National-Time-Series-Oct-2009-Jun-2024-with-Revisions.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">5</span>, range <span class="op">=</span> <span class="st">"B4:C181"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>monthly <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">monthly</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Modelling</span></span>
<span><span class="va">USCR_predictions_ENG</span> <span class="op">&lt;-</span> <span class="va">CWTUSC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month_no <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">CWTUSC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">monthly</span>, <span class="va">total</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">monthly</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  monthly <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">CWTUSC</span><span class="op">$</span><span class="va">monthly</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"month"</span>, length.out <span class="op">=</span> <span class="fl">69</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">USCR_predictions_ENG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">USCR_predictions_ENG</span>, <span class="va">future_dates</span><span class="op">)</span> <span class="co">#%&gt;% select(-4)</span></span>
<span></span>
<span><span class="co"># Fit regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span><span class="va">total_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">monthly</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_model_from19</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">monthly</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2019-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_model_from21</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">monthly</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2021-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_model_precovid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">monthly</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2020-03-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Make predictions</span></span>
<span><span class="va">USCR_predictions_ENG</span> <span class="op">&lt;-</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predicted_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">total_model</span>, newdata <span class="op">=</span> <span class="va">USCR_predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>    predicted_total_from19 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">total_model_from19</span>, newdata <span class="op">=</span> <span class="va">USCR_predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>    predicted_total_from21 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">total_model_from21</span>, newdata <span class="op">=</span> <span class="va">USCR_predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>    predicted_total_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">total_model_precovid</span>, newdata <span class="op">=</span> <span class="va">USCR_predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## To get new aggregate number</span></span>
<span><span class="va">England_USC_prediction</span> <span class="op">&lt;-</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    predicted_referrals_09 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_total</span><span class="op">)</span>,</span>
<span>    rounded_09 <span class="op">=</span> <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predicted_referrals_09</span><span class="op">)</span>,</span>
<span>    predicted_referrals_19 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_total_from19</span><span class="op">)</span>,</span>
<span>    predicted_referrals_21 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_total_from21</span><span class="op">)</span>,</span>
<span>    predicted_referrals_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_total_precovid</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">AnnualPercChange</span> <span class="op">&lt;-</span> <span class="va">USCR_predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#mutate(year = as.numeric(format(date,'%Y'))) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">monthly</span> <span class="op">&gt;=</span> <span class="st">"2023-07-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2023-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2024-07-01"</span>  <span class="op">~</span> <span class="st">"2023/24"</span>,</span>
<span>                          <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2025-07-01"</span>  <span class="op">~</span> <span class="st">"2024/25"</span>,</span>
<span>                          <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2025-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2026-07-01"</span>  <span class="op">~</span> <span class="st">"2025/26"</span>,</span>
<span>                          <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2026-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2027-07-01"</span>  <span class="op">~</span> <span class="st">"2026/27"</span>,</span>
<span>                          <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2027-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2028-07-01"</span>  <span class="op">~</span> <span class="st">"2027/28"</span>,</span>
<span>                          <span class="va">monthly</span> <span class="op">&gt;</span> <span class="st">"2028-06-01"</span> <span class="op">&amp;</span> <span class="va">monthly</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span>  <span class="op">~</span> <span class="st">"2028/29"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">total</span>, <span class="va">predicted_total</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AnnualPercChange</span> <span class="op">&lt;-</span> <span class="va">AnnualPercChange</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percent_inc <span class="op">=</span> <span class="va">total</span> <span class="op">/</span> <span class="va">AnnualPercChange</span><span class="op">[</span><span class="va">AnnualPercChange</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2023/24"</span>,<span class="op">]</span><span class="op">$</span><span class="va">total</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>         count_diff <span class="op">=</span> <span class="va">total</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">total</span>, n <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>         perc_diff <span class="op">=</span> <span class="va">percent_inc</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">percent_inc</span>, n <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>         yearno <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#increase in referrals at the end of term compared to 23/24</span></span>
<span><span class="va">USCPercChange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">AnnualPercChange</span><span class="op">[</span><span class="va">AnnualPercChange</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2028/29"</span>,<span class="op">]</span><span class="op">$</span><span class="va">total</span> <span class="op">/</span> <span class="va">AnnualPercChange</span><span class="op">[</span><span class="va">AnnualPercChange</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2023/24"</span>,<span class="op">]</span><span class="op">$</span><span class="va">total</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#Number</span></span>
<span><span class="va">ExtraReferrals</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">AnnualPercChange</span><span class="op">[</span><span class="va">AnnualPercChange</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2028/29"</span>,<span class="op">]</span><span class="op">$</span><span class="va">total</span> <span class="op">-</span> <span class="va">AnnualPercChange</span><span class="op">[</span><span class="va">AnnualPercChange</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2023/24"</span>,<span class="op">]</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By 2029, there are expected to be 21% more urgent cancer referrals than there were during the last year, which would be more than 648,000 people being referred for urgent suspected cancer.</p>
</section><section id="day-waits" class="level2"><h2 class="anchored" data-anchor-id="day-waits">31 day waits</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CWT31</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/CWT_31day_Overall_2024-09-04.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># From sst hub</span></span>
<span></span>
<span><span class="co"># England ---- </span></span>
<span></span>
<span><span class="co">## Filtering and tidying names of main data</span></span>
<span><span class="co">## Going to use only First treatments to match historic and other nations data like picking USC route for 62 decision.</span></span>
<span><span class="va">CWT31ENG</span> <span class="op">&lt;-</span> <span class="va">CWT31</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"England"</span> <span class="op">&amp;</span> <span class="va">FirstOrSubsequent</span> <span class="op">==</span> <span class="st">"First Treatment"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="op">-</span><span class="va">Country</span>, <span class="op">-</span><span class="va">FirstOrSubsequent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="va">date</span>, orders <span class="op">=</span> <span class="st">"my"</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Modelling</span></span>
<span><span class="va">predictions_ENG</span> <span class="op">&lt;-</span> <span class="va">CWT31ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month_no <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">CWT31ENG</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">count</span>, <span class="va">outside_target</span>, <span class="va">month_no</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">CWT31ENG</span><span class="op">$</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"month"</span>, length.out <span class="op">=</span> <span class="fl">69</span><span class="op">)</span>,</span>
<span>                           month_no <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">predictions_ENG</span><span class="op">$</span><span class="va">month_no</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">predictions_ENG</span><span class="op">$</span><span class="va">month_no</span><span class="op">)</span> <span class="op">+</span> <span class="fl">69</span>, </span>
<span>                                                length.out<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">predictions_ENG</span><span class="op">$</span><span class="va">month_no</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">predictions_ENG</span><span class="op">$</span><span class="va">month_no</span><span class="op">)</span> <span class="op">+</span> <span class="fl">69</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           outside_target <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                           count <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span> </span>
<span><span class="va">predictions_ENG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">future_dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fits guassian regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span><span class="va">Model_31_2009</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Model_31_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2019-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Model_31_2021</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2021-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Model_31_precovid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2020-03-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predictions_ENG</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>predicted_count_2009 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Model_31_2009</span>, newdata <span class="op">=</span> <span class="va">predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>         predicted_count_2019 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Model_31_2019</span>, newdata <span class="op">=</span> <span class="va">predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>         predicted_count_2021 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Model_31_2021</span>, newdata <span class="op">=</span> <span class="va">predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>         predicted_count_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Model_31_precovid</span>, newdata <span class="op">=</span> <span class="va">predictions_ENG</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>performance <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">outside_target</span><span class="op">/</span><span class="va">count</span><span class="op">)</span>,</span>
<span>         average_6m_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">count</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_outside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">outside_target</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_perf <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">average_6m_outside</span><span class="op">/</span><span class="va">average_6m_count</span><span class="op">)</span>,</span>
<span>         multiplier <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">average_6m_perf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## To get new aggregate number</span></span>
<span></span>
<span><span class="va">predictions_ENG_summary</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>predicted_count_2009 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_2009</span><span class="op">)</span>,</span>
<span>            predicted_count_2019 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_2019</span><span class="op">)</span>,</span>
<span>            predicted_count_2021 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_2021</span><span class="op">)</span>,</span>
<span>            predicted_count_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_precovid</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">England_outside</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>standard <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>         additional_patients <span class="op">=</span> <span class="op">(</span><span class="va">standard</span> <span class="op">-</span> <span class="va">multiplier</span><span class="op">)</span> <span class="op">*</span> <span class="va">predicted_count_2009</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#Adds in how many patients needed to meet target</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>additional_patients <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">additional_patients</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">EnglandAnnualFigures</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">date</span>,<span class="st">'%Y'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2023-07-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2023-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2024-07-01"</span> <span class="op">~</span> <span class="st">"2023/24"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2025-07-01"</span> <span class="op">~</span> <span class="st">"2024/25"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2025-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2026-07-01"</span> <span class="op">~</span> <span class="st">"2025/26"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2026-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2027-07-01"</span> <span class="op">~</span> <span class="st">"2026/27"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2027-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2028-07-01"</span> <span class="op">~</span> <span class="st">"2027/28"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2028-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span> <span class="op">~</span> <span class="st">"2028/29"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">count</span>, <span class="va">predicted_count_2009</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>graph code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#graph</span></span>
<span><span class="va">eng_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">predicted_count_2009</span>, </span>
<span>                colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2009 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2009</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2018-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">predicted_count_2019</span>, </span>
<span>                colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2019 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2019</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2021-01-01"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">predicted_count_2021</span>,</span>
<span>                colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2021 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2021</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"segment"</span>, </span>
<span>           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2024-06-30"</span><span class="op">)</span>, xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2024-06-30"</span><span class="op">)</span>, </span>
<span>           y <span class="op">=</span> <span class="fl">15000</span>, yend <span class="op">=</span> <span class="fl">38000</span>,</span>
<span>           colour <span class="op">=</span> <span class="st">"#BBC7D9"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">count</span><span class="op">)</span>, linewidth<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"England: 31-day model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 years"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2010-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2029-06-30"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Model and prediction"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">eng_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">predictions_ENG</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_2009</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2009 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2009</span><span class="op">)</span>, <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#ff0087"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2019-01-01"</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_2019</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2019 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2019</span><span class="op">)</span>, <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#009cee"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2021-01-01"</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_2021</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2021 - "</span>, <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_2021</span><span class="op">)</span>, <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#00007e"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2009-01-01"</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">count</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Historical data"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">config</span><span class="op">(</span>displaylogo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         toImageButtonOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>           format <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>           filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"England 31 day models"</span><span class="op">)</span>,</span>
<span>           width <span class="op">=</span> <span class="fl">1400</span>,</span>
<span>           height <span class="op">=</span> <span class="fl">600</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">layout</span><span class="op">(</span></span>
<span>    showlegend <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      orientation <span class="op">=</span> <span class="st">"h"</span>,</span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Model starting year and predicted number of patients over next parliamentary term"</span>,</span>
<span>                   font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>                   side <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>,</span>
<span>      font <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Number of people"</span>, </span>
<span>      showgrid <span class="op">=</span> <span class="cn">T</span>, </span>
<span>      zeroline <span class="op">=</span> <span class="cn">T</span>,</span>
<span>      tickmode <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span>      tickformat <span class="op">=</span> <span class="st">'~s'</span>,</span>
<span>      nticks <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40000</span><span class="op">)</span>,</span>
<span>      titlefont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>      tickfont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">""</span>, </span>
<span>      range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-01-01"</span>, <span class="st">"2030-01-01"</span><span class="op">)</span>,</span>
<span>      tickmode <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span>      nticks <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      showgrid <span class="op">=</span> <span class="cn">F</span>, </span>
<span>      tickfont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>      titlefont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Number of people starting treatment on the 31-day pathway&lt;br&gt;&lt;sup&gt;England&lt;/sup&gt;"</span>, </span>
<span>                 font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Progress Medium"</span>, </span>
<span>                             color <span class="op">=</span> <span class="st">"#000000"</span>,size <span class="op">=</span> <span class="fl">28</span><span class="op">)</span>,</span>
<span>                 xref <span class="op">=</span> <span class="st">'container'</span>,</span>
<span>                 xanchor <span class="op">=</span> <span class="st">'left'</span>,</span>
<span>                 x <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">80</span>, b <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="co">#Set margin sizes with t, b, r, l. </span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="va">eng_graph</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-05880c267a17f21886d0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-05880c267a17f21886d0">{"x":{"visdat":{"c0ec4b94436e":["function () ","plotlyVisDat"],"c0ec4db355d6":["function () ","data"],"c0ec13453962":["function () ","data"],"c0ec4bfc64ca":["function () ","data"]},"cur_data":"c0ec4bfc64ca","attrs":{"c0ec4b94436e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2009 - around 1,810,000 people","line":{"color":"#ff0087","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec4db355d6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2019 - around 1,940,000 people","line":{"color":"#009cee","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec13453962":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2021 - nearly 1,980,000 people","line":{"color":"#00007e","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec4bfc64ca":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Historical data","line":{"color":"#000000"},"type":"scatter","mode":"lines","inherit":true}},"layout":{"margin":{"b":30,"l":60,"t":80,"r":10},"showlegend":true,"legend":{"orientation":"h","y":-0.10000000000000001,"title":{"text":"Model starting year and predicted number of patients over next parliamentary term","font":{"family":"Poppins","color":"#000000","size":18},"side":"top"},"font":{"family":"Poppins","color":"#000000","size":14}},"yaxis":{"domain":[0,1],"automargin":true,"title":"Number of people","showgrid":true,"zeroline":true,"tickmode":"auto","tickformat":"~s","nticks":5,"range":[0,40000],"titlefont":{"family":"Poppins","color":"#000000","size":18},"tickfont":{"family":"Poppins","color":"#000000","size":14}},"xaxis":{"domain":[0,1],"automargin":true,"title":"","range":["2010-01-01","2030-01-01"],"tickmode":"auto","nticks":12,"showgrid":false,"tickfont":{"family":"Poppins","color":"#000000","size":14},"titlefont":{"family":"Poppins","color":"#000000","size":18}},"title":{"text":"Number of people starting treatment on the 31-day pathway<br><sup>England<\/sup>","font":{"family":"Progress Medium","color":"#000000","size":28},"xref":"container","xanchor":"left","x":0.01},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"toImageButtonOptions":{"format":"png","filename":"England 31 day models","width":1400,"height":600}},"data":[{"x":["2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[19248.890264496666,19303.056116831263,19355.474683606684,19409.640535941282,19463.806388275883,19512.73038393294,19566.896236267541,19619.314803042958,19673.48065537756,19725.899222152981,19780.065074487578,19834.23092682218,19886.649493597597,19940.815345932198,19993.233912707619,20047.399765042217,20101.565617376818,20150.489613033875,20204.655465368476,20257.074032143893,20311.239884478495,20363.658451253916,20417.824303588513,20471.990155923115,20524.408722698532,20578.574575033133,20630.993141808551,20685.158994143152,20739.324846477753,20789.99612769399,20844.161980028592,20896.580546804009,20950.74639913861,21003.164965914028,21057.330818248629,21111.49667058323,21163.915237358648,21218.081089693249,21270.499656468666,21324.665508803268,21378.831361137869,21427.755356794925,21481.921209129527,21534.339775904944,21588.505628239545,21640.924195014963,21695.090047349564,21749.255899684165,21801.674466459583,21855.840318794184,21908.258885569601,21962.424737904203,22016.5905902388,22065.51458589586,22119.680438230458,22172.099005005879,22226.26485734048,22278.683424115898,22332.849276450499,22387.015128785097,22439.433695560518,22493.599547895119,22546.018114670536,22600.183967005138,22654.349819339735,22703.273814996795,22757.439667331393,22809.858234106814,22864.024086441412,22916.442653216833,22970.608505551434,23024.774357886032,23077.192924661453,23131.35877699605,23183.777343771471,23237.943196106073,23292.10904844067,23342.780329656911,23396.946181991509,23449.36474876693,23503.530601101527,23555.949167876948,23610.11502021155,23664.280872546147,23716.699439321568,23770.865291656166,23823.283858431587,23877.449710766185,23931.615563100786,23980.539558757846,24034.705411092444,24087.123977867865,24141.289830202462,24193.708396977883,24247.874249312481,24302.040101647082,24354.458668422503,24408.624520757101,24461.043087532522,24515.20893986712,24569.374792201721,24618.298787858777,24672.464640193379,24724.8832069688,24779.049059303397,24831.467626078818,24885.633478413416,24939.799330748017,24992.217897523435,25046.383749858036,25098.802316633457,25152.968168968055,25207.134021302656,25256.058016959712,25310.223869294314,25362.642436069731,25416.808288404332,25469.226855179753,25523.392707514351,25577.558559848952,25629.97712662437,25684.142978958971,25736.561545734388,25790.72739806899,25844.893250403591,25895.564531619828,25949.730383954429,26002.148950729847,26056.314803064448,26108.733369839865,26162.899222174467,26217.065074509068,26269.483641284485,26323.649493619087,26376.068060394504,26430.233912729105,26484.399765063707,26533.323760720763,26587.489613055364,26639.908179830782,26694.074032165383,26746.492598940804,26800.658451275402,26854.824303609999,26907.24287038542,26961.408722720018,27013.827289495439,27067.993141830037,27122.158994164642,27171.082989821694,27225.248842156299,27277.66740893172,27331.833261266318,27384.251828041739,27438.417680376337,27492.583532710934,27545.002099486355,27599.167951820953,27651.586518596374,27705.752370930972,27759.918223265577,27808.842218922629,27863.008071257234,27915.426638032648,27969.592490367253,28022.011057142674,28076.176909477272,28130.342761811869,28182.76132858729,28236.927180921888,28289.345747697309,28343.511600031907,28397.677452366512,28448.348733582749,28502.514585917346,28554.933152692767,28609.099005027365,28661.517571802786,28715.683424137384,28769.849276471989,28822.267843247402,28876.433695582007,28928.852262357421,28983.018114692026,29037.183967026624,29086.107962683684,29140.273815018281,29192.692381793702,29246.8582341283,29299.276800903721,29353.442653238319,29407.608505572924,29460.027072348337,29514.192924682942,29566.611491458356,29620.777343792961,29674.943196127559,29723.867191784619,29778.033044119216,29830.451610894637,29884.617463229235,29937.036030004656,29991.201882339254,30045.367734673851,30097.786301449272,30151.952153783877,30204.370720559291,30258.536572893896,30312.702425228494,30361.626420885554,30415.792273220151,30468.210839995572,30522.37669233017,30574.795259105591,30628.961111440189,30683.126963774786,30735.545530550207,30789.711382884805,30842.129949660226,30896.295801994831,30950.461654329429,31001.132935545666,31055.298787880263,31107.717354655684,31161.883206990289,31214.301773765703,31268.467626100308,31322.633478434906,31375.052045210326,31429.217897544924,31481.636464320345,31535.802316654943,31589.968168989541,31638.892164646601,31693.058016981198,31745.476583756619,31799.642436091217,31852.061002866638,31906.226855201243,31960.392707535841,32012.811274311262,32066.977126645859,32119.39569342128,32173.561545755878,32227.727398090476,32276.651393747536],"name":"2009 - around 1,810,000 people","line":{"color":"#ff0087","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[23703.608776936588,23795.473924981288,23878.448897408769,23970.31404545347,24059.215801625764,24151.080949670471,24239.982705842765,24331.847853887466,24423.713001932167,24512.614758104461,24604.479906149169,24693.381662321462,24785.246810366163,24877.111958410871,24963.050322710751,25054.915470755459,25143.817226927753,25235.682374972454,25324.584131144748,25416.449279189455,25508.314427234156,25597.21618340645,25689.081331451158,25777.983087623452,25869.848235668152,25961.713383712853,26044.688356140334,26136.553504185034,26225.455260357328,26317.320408402029,26406.222164574323,26498.087312619031,26589.952460663731,26678.854216836025,26770.719364880733,26859.621121053027,26951.486269097728,27043.351417142436,27126.326389569909,27218.19153761461,27307.093293786904,27398.958441831612,27487.860198003906,27579.725346048606,27671.590494093314,27760.492250265608,27852.357398310309,27941.259154482603,28033.124302527311,28124.989450572011,28207.964422999485,28299.829571044193,28388.731327216487,28480.596475261187,28569.498231433481,28661.363379478182,28753.22852752289,28842.130283695184,28933.995431739884,29022.897187912178,29114.762335956886,29206.627484001587,29292.565848301474,29384.430996346175,29473.332752518469,29565.197900563177,29654.09965673547,29745.964804780171,29837.829952824879,29926.731708997173,30018.596857041874,30107.498613214168,30199.363761258868,30291.228909303576,30374.203881731049,30466.06902977575,30554.970785948044,30646.835933992752,30735.737690165046,30827.602838209747,30919.467986254454,31008.369742426748,31100.234890471449,31189.136646643743,31281.001794688451,31372.866942733152,31455.841915160625,31547.707063205333,31636.608819377627,31728.473967422327,31817.375723594621,31909.240871639329,32001.10601968403,32090.007775856324,32181.872923901032,32270.774680073326,32362.639828118026,32454.504976162727,32537.479948590208,32629.345096634908,32718.246852807202,32810.112000851906,32899.013757024193,32990.878905068908,33082.744053113609,33171.645809285896,33263.510957330611,33352.412713502898,33444.277861547598,33536.143009592313,33622.081373892186,33713.946521936901,33802.848278109188,33894.713426153889,33983.61518232619,34075.48033037089,34167.345478415591,34256.247234587892,34348.112382632593,34437.014138804894,34528.879286849595,34620.744434894295,34703.719407321769,34795.584555366469,34884.486311538771,34976.351459583471,35065.253215755758,35157.118363800473,35248.983511845174,35337.88526801746,35429.750416062176,35518.652172234462,35610.517320279163,35702.382468323878,35785.357440751352],"name":"2019 - around 1,940,000 people","line":{"color":"#009cee","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[25789.616861997725,25892.582876310233,25985.584437624755,26088.550451937263,26188.194981917113,26291.160996229621,26390.805526209464,26493.771540521979,26596.737554834486,26696.38208481433,26799.348099126837,26898.992629106688,27001.958643419195,27104.924657731703,27197.926219046225,27300.892233358732,27400.536763338583,27503.502777651091,27603.147307630934,27706.113321943441,27809.079336255956,27908.7238662358,28011.689880548307,28111.334410528158,28214.300424840665,28317.266439153173,28410.268000467695,28513.234014780202,28612.878544760053,28715.844559072561,28815.489089052404,28918.455103364911,29021.421117677426,29121.065647657269,29224.031661969777,29323.676191949628,29426.642206262135,29529.608220574635,29625.931266221829,29728.897280534336,29828.541810514187,29931.507824826695,30031.152354806531,30134.118369119053,30237.08438343156,30336.728913411396,30439.694927723904,30539.339457703754,30642.305472016262,30745.271486328769,30838.273047643292,30941.239061955799,31040.88359193565,31143.849606248157,31243.494136228008,31346.460150540515,31449.426164853023,31549.070694832873,31652.036709145381,31751.681239125232,31854.647253437739,31957.613267750246,32050.614829064769,32153.580843377276,32253.225373357127,32356.191387669634,32455.835917649471,32558.801931961993,32661.7679462745,32761.412476254336,32864.378490566844,32964.023020546694,33066.989034859202,33169.955049171709,33262.956610486232,33365.922624798739,33465.56715477859,33568.533169091097,33668.177699070948,33771.143713383455,33874.109727695963,33973.754257675813,34076.720271988321,34176.364801968171,34279.330816280679,34382.296830593186,34478.619876240366,34581.585890552873,34681.230420532724,34784.196434845231,34883.840964825082,34986.806979137589,35089.772993450097,35189.417523429947,35292.383537742455,35392.028067722291,35494.994082034798,35597.96009634732,35690.961657661843,35793.92767197435,35893.572201954186,35996.538216266694,36096.182746246544,36199.148760559052,36302.114774871559,36401.75930485141,36504.725319163917,36604.369849143768,36707.335863456276,36810.301877768783,36903.303439083305],"name":"2021 - nearly 1,980,000 people","line":{"color":"#00007e","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01"],"y":[19182,18809,19017,17762,17987,21876,18939,18250,20942,20870,20212,20782,19959,20825,18954,19046,18505,22576,18514,20438,22175,20529,21581,21235,20817,22310,20150,21042,20049,21729,19723,23350,19373,22275,21764,20501,23351,22288,19464,21986,19565,20126,21339,21754,20491,23651,21189,21881,23596,22158,21307,22643,20137,21998,21574,21617,22400,23874,20673,23230,23556,21464,22786,21767,20517,23532,21977,21002,24100,24829,21669,24281,23857,23420,23192,21967,22309,23316,22943,23112,24382,22650,24181,23831,23475,25251,22781,23912,21890,25741,21178,24519,25176,24482,25380,23533,24950,26129,22376,25200,21936,23798,24139,27213,26798,28007,27085,24830,28170,27209,23722,27437,23705,25210,25608,26326,25091,28246,25767,25611,28186,26287,24644,27464,24477,28881,20574,16965,19168,21954,20528,24801,25808,25503,25669,23353,23272,27958,25531,25350,28004,27606,26223,27672,26126,28254,26693,26120,25426,28750,24920,28815,26806,26989,28429,27953,28291,30464,26085,28628,26283,29927,24923,29336,30098,28395,29134,27996,29905,31863,26730,31444,29419,29300,29803,30623,28717],"name":"Historical data","line":{"color":"#000000"},"type":"scatter","mode":"lines","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="day-wait" class="level2"><h2 class="anchored" data-anchor-id="day-wait">62 day wait</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CWT62</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/CWT_62day_By cancer site_2024-09-05.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># From sst hub</span></span>
<span><span class="co"># England ---- </span></span>
<span></span>
<span><span class="co">## Filtering and tidying names of main data</span></span>
<span><span class="va">CWT62ENG</span> <span class="op">&lt;-</span> <span class="va">CWT62</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"England"</span> <span class="op">&amp;</span> <span class="va">RefRoute</span> <span class="op">==</span> <span class="st">"Urgent Suspected Cancer"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="va">date</span>, orders <span class="op">=</span> <span class="st">"my"</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Old other routes data NB: all sites</span></span>
<span><span class="va">CWT_historic_other_routes_allsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"data/Cancer-Waiting-Times-National-Time-Series-Oct-2009-Sep-2023-with-Revisions.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">2</span>, range<span class="op">=</span><span class="st">"AY4:BC172"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ref_route <span class="op">=</span> <span class="st">"Screening"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># </span></span>
<span>  <span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"data/Cancer-Waiting-Times-National-Time-Series-Oct-2009-Sep-2023-with-Revisions.xlsx"</span>, sheet <span class="op">=</span><span class="fl">2</span>, range <span class="op">=</span> <span class="st">"BF4:BJ172"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ref_route <span class="op">=</span> <span class="st">"Consultant Upgrade"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">monthly</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>         factor <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">factor</span>, <span class="va">ref_route</span>, <span class="va">total</span>, <span class="va">within_standard</span>, <span class="va">outside_standard</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ref_route</span>, <span class="va">factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    count <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    within_target <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">within_standard</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    outside_target <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outside_standard</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    percent_within_target <span class="op">=</span> <span class="va">within_target</span> <span class="op">/</span> <span class="va">count</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">CWT62ENG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">CWT62ENG</span>, <span class="va">CWT_historic_other_routes_allsite</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">CWT_historic_other_routes_allsite</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Sep23-recent new routes data </span></span>
<span><span class="va">newroutes_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/CWT_62day_By cancer site_2024-09-05.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ref_route</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Consultant Upgrade"</span>, <span class="st">"Screening"</span><span class="op">)</span> <span class="op">|</span> <span class="va">date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Oct-23"</span>, <span class="st">"Nov-23"</span>, <span class="st">"Dec-23"</span>, <span class="st">"Jan-24"</span>, <span class="st">"Feb-24"</span>, <span class="st">"Mar-24"</span>, <span class="st">"Apr-24"</span>, <span class="st">"May-24"</span>, <span class="st">"Jun-24"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">factor</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Urological (excl. prostate)"</span>,<span class="st">"Prostate"</span>, <span class="st">"Gynaecological"</span>, <span class="st">"Lymphoma"</span>, <span class="st">"Haematological (excl. lymphoma)"</span>, <span class="st">"Head and neck"</span>, <span class="st">"Other (new grouping)"</span>, <span class="st">"Oesophagus and stomach"</span>, <span class="st">"Hepatobiliary"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#download includes both separate and combined routes for other and uro so below can remove the separate new sites</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ref_route</span>, total <span class="op">=</span> <span class="va">count</span>, <span class="va">within_target</span>, <span class="va">outside_target</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="va">date</span>, orders <span class="op">=</span> <span class="st">"my"</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>         factor <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ref_route</span>, <span class="va">factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    count <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    within_target <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">within_target</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    outside_target <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outside_target</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    percent_within_target <span class="op">=</span> <span class="va">within_target</span> <span class="op">/</span> <span class="va">count</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">CWT62ENG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">CWT62ENG</span>, <span class="va">newroutes_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">newroutes_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Fixing site names and grouping</span></span>
<span><span class="va">CWT62ENG</span> <span class="op">&lt;-</span> <span class="va">CWT62ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">standard_hit</span>, <span class="op">-</span><span class="va">additional_patients</span>, <span class="op">-</span><span class="va">target_last_met</span>, <span class="op">-</span><span class="va">rank</span>, <span class="op">-</span><span class="va">standard</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">factor</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Urological (excl. prostate)"</span>, <span class="st">"Prostate"</span>, </span>
<span>                        <span class="st">"Gynaecological"</span>, <span class="st">"Lymphoma"</span>, <span class="st">"Haematological (excl. lymphoma)"</span>, </span>
<span>                        <span class="st">"Head and neck"</span>, <span class="st">"Other (new grouping)"</span>, <span class="st">"Oesophagus and stomach"</span>, </span>
<span>                        <span class="st">"Hepatobiliary"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#download includes both separate and combined routes for other and uro so below can remove the separate new sites</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">factor</span>, <span class="va">ref_route</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,</span>
<span>    within_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">within_target</span><span class="op">)</span>,</span>
<span>    outside_target <span class="op">=</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/round_half_up.html">round_half_up</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outside_target</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    percent_within_target <span class="op">=</span> <span class="va">within_target</span> <span class="op">/</span> <span class="va">count</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">CWT62ENG</span><span class="op">$</span><span class="va">ref_route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sfirke.github.io/janitor/reference/make_clean_names.html">make_clean_names</a></span><span class="op">(</span><span class="va">CWT62ENG</span><span class="op">$</span><span class="va">ref_route</span>, allow_dupes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Split into list with each element a df a site subset</span></span>
<span><span class="va">CWT62ENGsplit</span> <span class="op">&lt;-</span> <span class="va">CWT62ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ref_route</span>, <span class="va">factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span>.keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Adding names to each df list element</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">CWT62ENGsplit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">CWT62ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ref_route</span>, <span class="va">factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_data.html">group_keys</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="va">ref_route</span><span class="op">:</span><span class="va">factor</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Modelling</span></span>
<span><span class="va">predictions_ENG</span> <span class="op">&lt;-</span> <span class="va">CWT62ENGsplit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">enframe</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"list"</span>, value <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># converts lists to single df</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># function to add 60 blank months to each df list element</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span> </span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>               month_no <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">count</span>, <span class="va">outside_target</span>, <span class="va">month_no</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span>      <span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span>
<span>      <span class="va">last_no</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">month_no</span><span class="op">)</span></span>
<span>      <span class="co">#future_dates &lt;- seq.Date(from = last_date + months(1), by = "month", length.out = 60)</span></span>
<span>      <span class="va">future_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">last_date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"month"</span>, length.out <span class="op">=</span> <span class="fl">69</span><span class="op">)</span>,</span>
<span>                                 month_no <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">last_no</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>                                                <span class="va">last_no</span> <span class="op">+</span> <span class="fl">69</span>, </span>
<span>                                                length.out<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">(</span><span class="va">last_no</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">last_no</span> <span class="op">+</span> <span class="fl">69</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 outside_target <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                                 count <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">future_dates</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Fits gaussian regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span>    count_model_09 <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">month_no</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    count_model_19 <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">month_no</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2019-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    count_model_21 <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">month_no</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2021-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    count_model_precovid <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">month_no</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2020-03-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># function to use the models to predict the NA rows for count</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">count_model_09</span>, <span class="va">data</span>, \<span class="op">(</span><span class="va">mod</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_09</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_09</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_09</span></span>
<span>     <span class="co"># data$predicted_count_09[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span>      <span class="va">data</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">count_model_19</span>, <span class="va">data</span>, \<span class="op">(</span><span class="va">mod</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_19</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_19</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_19</span></span>
<span>     <span class="co"># data$predicted_count_19[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span>      <span class="va">data</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">count_model_21</span>, <span class="va">data</span>, \<span class="op">(</span><span class="va">mod</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_21</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_21</span></span>
<span>      <span class="co">#data$predicted_count_21[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span>      <span class="va">data</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">count_model_precovid</span>, <span class="va">data</span>, \<span class="op">(</span><span class="va">mod</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_precovid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_precovid</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">predicted_count_precovid</span></span>
<span>      <span class="co">#data$predicted_count_precovid[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span>      <span class="va">data</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">count_model_09</span>, <span class="op">-</span><span class="va">count_model_19</span>, <span class="va">count_model_21</span>, <span class="va">count_model_precovid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>performance <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">outside_target</span><span class="op">/</span><span class="va">count</span><span class="op">)</span>,</span>
<span>         average_6m_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">count</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_outside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">outside_target</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_perf <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">average_6m_outside</span><span class="op">/</span><span class="va">average_6m_count</span><span class="op">)</span>,</span>
<span>         multiplier <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">average_6m_perf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">list</span>, sep <span class="op">=</span> <span class="st">":"</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ref_route"</span>, <span class="st">"cancer_type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>predicted_outside <span class="op">=</span> <span class="va">predicted_count_09</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">multiplier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## TO see last X period averages: </span></span>
<span><span class="co"># predictions_ENG %&gt;% filter(date == "2024-06-01") </span></span>
<span></span>
<span><span class="co">## To get new aggregate number</span></span>
<span><span class="co">#Projected patients starting treatment over 5 years</span></span>
<span><span class="va">England_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2024-07-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span><span class="op">$</span><span class="va">predicted_count_09</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Projected number of patients needed to meet target</span></span>
<span><span class="va">England_outside</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>standard <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>         additional_patients <span class="op">=</span> <span class="op">(</span><span class="va">standard</span> <span class="op">-</span> <span class="va">multiplier</span><span class="op">)</span> <span class="op">*</span> <span class="va">predicted_count_09</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#Adds in how many patients needed to meet target</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>additional_patients <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">additional_patients</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">predictions_ENG_all</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"England"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">month_no</span>, <span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,</span>
<span>            outside_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outside_target</span><span class="op">)</span>,</span>
<span>            predicted_count_09 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_09</span><span class="op">)</span>,</span>
<span>            predicted_count_19 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_19</span><span class="op">)</span>,</span>
<span>            predicted_count_21 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_21</span><span class="op">)</span>,</span>
<span>            predicted_count_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_precovid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>performance <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">outside_target</span><span class="op">/</span><span class="va">count</span><span class="op">)</span>,</span>
<span>         average_6m_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">count</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_outside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">outside_target</span>, <span class="fl">6</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>,</span>
<span>         average_6m_perf <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">average_6m_outside</span><span class="op">/</span><span class="va">average_6m_count</span><span class="op">)</span>,</span>
<span>         multiplier <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">average_6m_perf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>predicted_outside <span class="op">=</span> <span class="va">predicted_count_09</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">multiplier</span><span class="op">)</span>,</span>
<span>         ref_route <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>         cancer_type <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual change figure for England ------</span></span>
<span><span class="co"># Spoke with Sam on this one, and he suggested that the normal way to get a </span></span>
<span><span class="co"># percentage change is to do a quick glm and get the coefficient. Didn't use our</span></span>
<span><span class="co"># actual model because we wanted it to be compared to 2023/24 instead of the full</span></span>
<span><span class="co"># trend. Poisson model is here because we played with that out of interest, but</span></span>
<span><span class="co"># it basically came to a similar number anyways. Going with 2.3% as our yearly change.</span></span>
<span></span>
<span><span class="va">EnglandAnnualFigures</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">date</span>,<span class="st">'%Y'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2023-07-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2023-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2024-07-01"</span>  <span class="op">~</span> <span class="st">"2023/24"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2025-07-01"</span> <span class="op">~</span> <span class="st">"2024/25"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2025-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2026-07-01"</span>  <span class="op">~</span> <span class="st">"2025/26"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2026-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2027-07-01"</span>  <span class="op">~</span> <span class="st">"2026/27"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2027-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2028-07-01"</span>  <span class="op">~</span> <span class="st">"2027/28"</span>,</span>
<span>                          <span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2028-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span>  <span class="op">~</span> <span class="st">"2028/29"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">count</span>, <span class="va">predicted_count_09</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">EnglandAnnualFigures</span> <span class="op">&lt;-</span> <span class="va">EnglandAnnualFigures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percent_inc <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">EnglandAnnualFigures</span><span class="op">[</span><span class="va">EnglandAnnualFigures</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2023/24"</span>,<span class="op">]</span><span class="op">$</span><span class="va">count</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>         count_diff <span class="op">=</span> <span class="va">count</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">count</span>, n <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>         perc_diff <span class="op">=</span> <span class="va">percent_inc</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">percent_inc</span>, n <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>         yearno <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">YearInc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">~</span> <span class="va">yearno</span>, <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">EnglandAnnualFigures</span><span class="op">)</span></span>
<span><span class="co">#The annual %age increase</span></span>
<span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">YearInc</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>  </span>
<span></span>
<span></span>
<span><span class="va">EnglandAnnualFigures</span> <span class="op">&lt;-</span> <span class="va">EnglandAnnualFigures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>increase <span class="op">=</span> <span class="op">(</span><span class="va">coef</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">count</span>, n <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>         new_total <span class="op">=</span> <span class="va">count</span><span class="op">+</span> <span class="va">increase</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predictions_ENG_summary</span> <span class="op">&lt;-</span> <span class="va">predictions_ENG_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2024-06-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2029-07-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>predicted_count_09 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_09</span><span class="op">)</span>,</span>
<span>            predicted_count_19 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_19</span><span class="op">)</span>,</span>
<span>            predicted_count_21 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_21</span><span class="op">)</span>,</span>
<span>            predicted_count_precovid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">predicted_count_precovid</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">predictions_ENG_all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_09</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2009 - "</span>,</span>
<span>                          <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_09</span><span class="op">)</span>,</span>
<span>                          <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#ff0087"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG_all</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2019-01-01"</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_19</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2019 - "</span>, </span>
<span>                          <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_19</span><span class="op">)</span>, </span>
<span>                          <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#009cee"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG_all</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2021-01-01"</span><span class="op">)</span>, </span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">predicted_count_21</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"2021 - "</span>, </span>
<span>                          <span class="fu">CRUKRoundingPerYear</span><span class="op">(</span><span class="va">predictions_ENG_summary</span><span class="op">$</span><span class="va">predicted_count_21</span><span class="op">)</span>, </span>
<span>                          <span class="st">" people"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#00007e"</span>, dash <span class="op">=</span> <span class="st">'dash'</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predictions_ENG_all</span>, <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2009-01-01"</span><span class="op">)</span>, </span>
<span>            x <span class="op">=</span> <span class="op">~</span><span class="va">date</span>, </span>
<span>            y <span class="op">=</span> <span class="op">~</span><span class="va">count</span>,</span>
<span>            name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Historical data"</span><span class="op">)</span>, </span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">'scatter'</span>, </span>
<span>            mode <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span><span class="co">#eng_graph &lt;- ggplotly(eng_graph) %&gt;%</span></span>
<span>  <span class="fu">config</span><span class="op">(</span>displaylogo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         toImageButtonOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>           format <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>           filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"England 62 day models"</span><span class="op">)</span>,</span>
<span>           width <span class="op">=</span> <span class="fl">1400</span>,</span>
<span>           height <span class="op">=</span> <span class="fl">600</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">layout</span><span class="op">(</span></span>
<span>    showlegend <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      orientation <span class="op">=</span> <span class="st">"h"</span>,</span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Model starting year and predicted number of patients over next parliamentary term"</span>,</span>
<span>                   font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>                   side <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>,</span>
<span>      font <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Number of people"</span>, </span>
<span>      showgrid <span class="op">=</span> <span class="cn">T</span>, </span>
<span>      zeroline <span class="op">=</span> <span class="cn">T</span>,</span>
<span>      tickmode <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span>      tickformat <span class="op">=</span> <span class="st">'~s'</span>,</span>
<span>      nticks <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40000</span><span class="op">)</span>,</span>
<span>      titlefont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>      tickfont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">""</span>, </span>
<span>      range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-01-01"</span>, <span class="st">"2030-01-01"</span><span class="op">)</span>,</span>
<span>      tickmode <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span>      nticks <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      showgrid <span class="op">=</span> <span class="cn">F</span>, </span>
<span>      tickfont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color<span class="op">=</span> <span class="st">"#000000"</span>, size<span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>      titlefont <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Poppins"</span>, color <span class="op">=</span> <span class="st">"#000000"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Number of people starting treatment on the 62-day pathway&lt;br&gt;&lt;sup&gt;England&lt;/sup&gt;"</span>, </span>
<span>                 font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Progress Medium"</span>, </span>
<span>                             color <span class="op">=</span> <span class="st">"#000000"</span>,size <span class="op">=</span> <span class="fl">28</span><span class="op">)</span>,</span>
<span>                 xref <span class="op">=</span> <span class="st">'container'</span>,</span>
<span>                 xanchor <span class="op">=</span> <span class="st">'left'</span>,</span>
<span>                 x <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">75</span>, b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co">#Set margin sizes with t, b, r, l. </span></span>
<span>  <span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ca1f3a6efb37a7c1924e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ca1f3a6efb37a7c1924e">{"x":{"visdat":{"c0ec6dab30ec":["function () ","plotlyVisDat"],"c0ec316e2f88":["function () ","data"],"c0ec5b083914":["function () ","data"],"c0ec477941c":["function () ","data"]},"cur_data":"c0ec477941c","attrs":{"c0ec6dab30ec":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2009 - around 1,530,000 people","line":{"color":"#ff0087","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec316e2f88":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2019 - around 1,750,000 people","line":{"color":"#009cee","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec5b083914":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"2021 - nearly 1,860,000 people","line":{"color":"#00007e","dash":"dash"},"type":"scatter","mode":"lines","inherit":true},"c0ec477941c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Historical data","line":{"color":"#000000"},"type":"scatter","mode":"lines","inherit":true}},"layout":{"margin":{"b":10,"l":60,"t":75,"r":10},"showlegend":true,"legend":{"orientation":"h","y":-0.10000000000000001,"title":{"text":"Model starting year and predicted number of patients over next parliamentary term","font":{"family":"Poppins","color":"#000000","size":18},"side":"top"},"font":{"family":"Poppins","color":"#000000","size":14}},"yaxis":{"domain":[0,1],"automargin":true,"title":"Number of people","showgrid":true,"zeroline":true,"tickmode":"auto","tickformat":"~s","nticks":5,"range":[0,40000],"titlefont":{"family":"Poppins","color":"#000000","size":18},"tickfont":{"family":"Poppins","color":"#000000","size":14}},"xaxis":{"domain":[0,1],"automargin":true,"title":"","range":["2010-01-01","2030-01-01"],"tickmode":"auto","nticks":12,"showgrid":false,"tickfont":{"family":"Poppins","color":"#000000","size":14},"titlefont":{"family":"Poppins","color":"#000000","size":18}},"title":{"text":"Number of people starting treatment on the 62-day pathway<br><sup>England<\/sup>","font":{"family":"Progress Medium","color":"#000000","size":28},"xref":"container","xanchor":"left","x":0.01},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"toImageButtonOptions":{"format":"png","filename":"England 62 day models","width":1400,"height":600}},"data":[{"x":["2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[9796.4805433885595,9872.8057195454821,9949.1308957024048,10025.456071859327,10101.78124801625,10178.106424173173,10254.431600330096,10330.756776487018,10407.081952643941,10483.407128800864,10559.732304957786,10636.057481114709,10712.38265727163,10788.707833428552,10865.033009585475,10941.358185742398,11017.683361899321,11094.008538056243,11170.333714213166,11246.658890370089,11322.984066527009,11399.309242683932,11475.634418840855,11551.959594997777,11628.2847711547,11704.609947311623,11780.935123468545,11857.260299625468,11933.585475782391,12009.910651939314,12086.235828096234,12162.561004253159,12238.88618041008,12315.211356567002,12391.536532723925,12467.861708880848,12544.18688503777,12620.512061194693,12696.837237351616,12773.162413508539,12849.487589665459,12925.812765822382,13002.137941979305,13078.463118136227,13154.78829429315,13231.113470450073,13307.438646606995,13383.763822763918,13460.088998920841,13536.414175077764,13612.739351234686,13689.064527391607,13765.38970354853,13841.714879705452,13918.040055862375,13994.365232019298,14070.69040817622,14147.015584333143,14223.340760490066,14299.665936646988,14375.991112803911,14452.316288960834,14528.641465117757,14604.966641274677,14681.2918174316,14757.616993588523,14833.942169745445,14910.267345902368,14986.592522059291,15062.917698216213,15139.242874373136,15215.568050530059,15291.89322668698,15368.218402843902,15444.543579000825,15520.868755157748,15597.19393131467,15673.519107471593,15749.844283628516,15826.169459785438,15902.494635942359,15978.819812099282,16055.144988256206,16131.470164413127,16207.79534057005,16284.120516726973,16360.445692883895,16436.770869040818,16513.096045197741,16589.421221354663,16665.746397511586,16742.071573668509,16818.396749825431,16894.721925982354,16971.047102139277,17047.3722782962,17123.697454453119,17200.022630610041,17276.347806766968,17352.672982923887,17428.998159080809,17505.323335237732,17581.648511394655,17657.973687551577,17734.2988637085,17810.624039865423,17886.949216022345,17963.274392179268,18039.599568336191,18115.924744493113,18192.249920650036,18268.575096806959,18344.900272963881,18421.225449120804,18497.550625277727,18573.875801434649,18650.200977591569,18726.526153748491,18802.851329905414,18879.176506062337,18955.501682219259,19031.826858376182,19108.152034533105,19184.477210690027,19260.80238684695,19337.127563003873,19413.452739160795,19489.777915317718,19566.103091474641,19642.428267631563,19718.753443788486,19795.078619945409,19871.403796102331,19947.728972259254,20024.054148416177,20100.379324573099,20176.704500730022,20253.029676886945,20329.354853043864,20405.680029200787,20482.005205357709,20558.330381514632,20634.655557671555,20710.980733828477,20787.3059099854,20863.631086142323,20939.956262299245,21016.281438456168,21092.606614613091,21168.931790770013,21245.256966926936,21321.582143083859,21397.907319240781,21474.232495397704,21550.557671554627,21626.882847711546,21703.208023868468,21779.533200025395,21855.858376182314,21932.183552339236,22008.508728496159,22084.833904653082,22161.159080810005,22237.484256966927,22313.80943312385,22390.134609280773,22466.459785437695,22542.784961594618,22619.110137751541,22695.435313908463,22771.760490065386,22848.085666222309,22924.410842379231,23000.736018536154,23077.061194693077,23153.386370849999,23229.711547006918,23306.036723163841,23382.361899320764,23458.687075477686,23535.012251634609,23611.337427791532,23687.662603948454,23763.987780105377,23840.3129562623,23916.638132419223,23992.963308576145,24069.288484733068,24145.613660889991,24221.938837046913,24298.264013203836,24374.589189360759,24450.914365517681,24527.239541674604,24603.564717831527,24679.889893988449,24756.215070145372,24832.540246302295,24908.865422459214,24985.190598616136,25061.515774773059,25137.840950929982,25214.166127086904,25290.491303243827,25366.81647940075,25443.141655557672,25519.466831714595,25595.792007871518,25672.117184028441,25748.442360185363,25824.767536342286,25901.092712499209,25977.417888656131,26053.743064813054,26130.068240969977,26206.393417126899,26282.718593283818,26359.043769440741,26435.368945597667,26511.694121754586,26588.019297911509,26664.344474068432,26740.669650225354,26816.994826382277,26893.3200025392,26969.645178696122,27045.970354853045,27122.295531009968,27198.62070716689,27274.945883323813,27351.271059480736,27427.596235637659,27503.921411794581,27580.2465879515,27656.571764108423,27732.896940265349,27809.222116422268,27885.547292579191,27961.872468736117,28038.197644893036,28114.522821049959,28190.847997206882,28267.173173363804,28343.498349520727,28419.82352567765,28496.148701834572],"name":"2009 - around 1,530,000 people","line":{"color":"#ff0087","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[16213.084615384607,16349.211188811181,16485.337762237756,16621.464335664328,16757.590909090901,16893.717482517477,17029.84405594405,17165.970629370622,17302.097202797195,17438.223776223771,17574.350349650344,17710.476923076916,17846.603496503492,17982.730069930065,18118.856643356638,18254.98321678321,18391.109790209783,18527.236363636359,18663.362937062931,18799.489510489504,18935.616083916077,19071.742657342653,19207.869230769225,19343.995804195798,19480.122377622371,19616.248951048947,19752.375524475519,19888.502097902092,20024.628671328668,20160.755244755241,20296.881818181813,20433.008391608386,20569.134965034962,20705.261538461535,20841.388111888107,20977.51468531468,21113.641258741256,21249.767832167825,21385.894405594401,21522.020979020974,21658.147552447546,21794.274125874123,21930.400699300695,22066.527272727268,22202.65384615384,22338.780419580416,22474.906993006989,22611.033566433562,22747.160139860138,22883.28671328671,23019.413286713283,23155.539860139856,23291.666433566432,23427.793006993004,23563.919580419577,23700.04615384615,23836.172727272726,23972.299300699298,24108.425874125871,24244.552447552443,24380.67902097902,24516.805594405592,24652.932167832165,24789.058741258737,24925.18531468531,25061.311888111886,25197.438461538459,25333.565034965031,25469.691608391604,25605.81818181818,25741.944755244753,25878.071328671325,26014.197902097902,26150.324475524474,26286.451048951047,26422.577622377623,26558.704195804195,26694.830769230768,26830.957342657341,26967.083916083913,27103.210489510486,27239.337062937062,27375.463636363635,27511.590209790207,27647.71678321678,27783.843356643352,27919.969930069929,28056.096503496501,28192.223076923074,28328.34965034965,28464.476223776222,28600.602797202795,28736.729370629371,28872.85594405594,29008.982517482516,29145.109090909089,29281.235664335662,29417.362237762238,29553.488811188807,29689.615384615383,29825.741958041959,29961.868531468528,30097.995104895104,30234.121678321677,30370.248251748249,30506.374825174826,30642.501398601398,30778.627972027971,30914.754545454543,31050.88111888112,31187.007692307692,31323.134265734265,31459.260839160837,31595.38741258741,31731.513986013986,31867.640559440559,32003.767132867131,32139.893706293704,32276.020279720276,32412.146853146853,32548.273426573425,32684.399999999998,32820.52657342657,32956.653146853147,33092.779720279723,33228.906293706292,33365.032867132868,33501.159440559437,33637.286013986013,33773.412587412589,33909.539160839158,34045.665734265734,34181.792307692303,34317.91888111888,34454.045454545456],"name":"2019 - around 1,750,000 people","line":{"color":"#009cee","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01","2025-10-01","2025-11-01","2025-12-01","2026-01-01","2026-02-01","2026-03-01","2026-04-01","2026-05-01","2026-06-01","2026-07-01","2026-08-01","2026-09-01","2026-10-01","2026-11-01","2026-12-01","2027-01-01","2027-02-01","2027-03-01","2027-04-01","2027-05-01","2027-06-01","2027-07-01","2027-08-01","2027-09-01","2027-10-01","2027-11-01","2027-12-01","2028-01-01","2028-02-01","2028-03-01","2028-04-01","2028-05-01","2028-06-01","2028-07-01","2028-08-01","2028-09-01","2028-10-01","2028-11-01","2028-12-01","2029-01-01","2029-02-01","2029-03-01","2029-04-01","2029-05-01","2029-06-01","2029-07-01","2029-08-01","2029-09-01","2029-10-01","2029-11-01","2029-12-01","2030-01-01","2030-02-01","2030-03-01"],"y":[18783.09634146341,18954.146341463409,19125.196341463408,19296.246341463408,19467.296341463407,19638.34634146341,19809.396341463409,19980.446341463408,20151.496341463408,20322.546341463407,20493.59634146341,20664.646341463409,20835.696341463408,21006.746341463408,21177.796341463407,21348.846341463406,21519.896341463409,21690.946341463405,21861.996341463408,22033.04634146341,22204.096341463406,22375.146341463409,22546.196341463405,22717.246341463408,22888.29634146341,23059.346341463406,23230.396341463409,23401.446341463408,23572.496341463408,23743.54634146341,23914.596341463406,24085.646341463409,24256.696341463408,24427.746341463408,24598.79634146341,24769.84634146341,24940.896341463409,25111.946341463408,25282.996341463408,25454.04634146341,25625.09634146341,25796.146341463409,25967.196341463408,26138.246341463411,26309.29634146341,26480.34634146341,26651.396341463409,26822.446341463408,26993.496341463408,27164.54634146341,27335.59634146341,27506.646341463409,27677.696341463408,27848.746341463411,28019.79634146341,28190.84634146341,28361.896341463409,28532.946341463408,28703.996341463411,28875.04634146341,29046.09634146341,29217.146341463409,29388.196341463408,29559.246341463411,29730.29634146341,29901.34634146341,30072.396341463413,30243.446341463408,30414.496341463411,30585.546341463414,30756.59634146341,30927.646341463413,31098.696341463408,31269.746341463411,31440.79634146341,31611.84634146341,31782.896341463413,31953.946341463412,32124.996341463411,32296.046341463407,32467.09634146341,32638.146341463409,32809.196341463408,32980.246341463411,33151.296341463407,33322.34634146341,33493.396341463413,33664.446341463408,33835.496341463411,34006.546341463407,34177.59634146341,34348.646341463413,34519.696341463408,34690.746341463411,34861.796341463407,35032.84634146341,35203.896341463413,35374.946341463408,35545.996341463411,35717.046341463407,35888.09634146341,36059.146341463413,36230.196341463408,36401.246341463411,36572.296341463407,36743.34634146341,36914.396341463413,37085.446341463408,37256.496341463411,37427.546341463407,37598.59634146341],"name":"2021 - nearly 1,860,000 people","line":{"color":"#00007e","dash":"dash"},"type":"scatter","mode":"lines","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01"],"y":[10311,10317,10481,9640,9620,12062,10613,10315,11862,11873,11559,11803,11246,11847,10862,10488,10209,12861,10798,11831,12803,12019,12710,12519,11967,12896,12067,12125,11497,12728,11773,13813,11537,13407,13031,12261,13783,13482,11903,12897,11539,12210,12837,13157,12505,14396,13127,13463,14606,13584,13131,13984,12206,13546,13553,13656,13951.5,15239,13112,14469,14644,13624,14559,13780,12743,15090,14159,13522,15516,15980,14205,15763,15288,15249,15185,14068,14408,15307,15193.5,15398,16357,15238,16303,15828,15594,16913,15261,15998,14537,17327,14301,16633,17109,16640,17423,15858,16775,17923,15308,17157,14845,16523,16733,19071,19096,19841,19365,17708,19796,19346,16950,19450,16808,18075,18489,19054,18042,20461,18723,18728,20511,19002,17976,20024,17740,21567,15264,11919,13357,15524,14670,18113,18833,18788,19329,17464,17397,20777,19190,19228,21320,21157,20214,21281,20067,21716,20579,20096,19474,22303,19346,22563,20997,21148,22460,22003,22236,24042,20709,22739,20907,23954,19903,23351,24059,23040,23865,23143,24896,26818,22855,27130,25613,25637,26338,27189,25641],"name":"Historical data","line":{"color":"#000000"},"type":"scatter","mode":"lines","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="what-would-i-do-differently" class="level2"><h2 class="anchored" data-anchor-id="what-would-i-do-differently">What would I do differently?</h2>
<p>Initially I had started out using a poisson/quasi-poisson model approach with some adjustments (such as varying the number of natural splines).</p>
<!-- -->

</section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb11" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Cancer waiting times projections over the parliamentary term"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: arrow</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: Poppins</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>• A brief explanation of what problem you are trying to solve and the data you have used</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>• The approach you have taken to solving the problem</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    Linear regression models to make predictions on patient volumes over the next 5 years. Ran different 3 different models with different start dates to get best estimates, ultimately settling on the model that used all available historical data. There was some debate about using more recent models, but it seemed likely they overinterpreted some recent trends. </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>• What you learned in this project from an analysis and coding perspective</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    One of my big learnings was to always keep in mind what the goal for a piece of work is. For this, the goal was to warn about potential problems in cancer care if nothing changed. The goal wasn't to model the best predictions for what will happen in the next five years. </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>• Reflections on what you would do differently in another project</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    I would still have liked to explore a more robust modelling approach to this piece, maybe a general additive model so that we could build in some degree of plateau to the predictions, but time wasn't available to do that - especially after the poisson model we were using didn't seem to produce reliable results. </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Project aims</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>This code was part of a project to model cancer waiting times over the next parliamentary term, during the run up to the general election with the aim of landing a high profile press story to help keep cancer high on the policy agenda, and support other influencing work.</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>In line with this aim, there were three key pieces of information to generate:</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Number of urgent cancer referrals being made - tracked by NHS England as urgent suspected cancer referrals</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Number of people starting treatment - tracked by NHS England with their 31 day wait metric</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>How many won't start their treatment within the NHS England target window - tracked via the NHS England 62 day wait metric</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>Across all 3 metrics I used guassian linear regression modelling </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: show</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Libraries used"</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(janitor)</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(rms)</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(plotly)</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(zoo)</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: rounding function</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>CRUKRoundingPerYear <span class="ot">&lt;-</span> <span class="cf">function</span>(number){</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number &lt;- 10050000</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  number <span class="ot">&lt;-</span>  <span class="fu">case_when</span>(</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">1000000</span>) <span class="sc">*</span> <span class="dv">1000000</span> <span class="sc">==</span> <span class="dv">500</span> <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">~</span> number,</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span>  <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">100000</span>)  <span class="sc">*</span> <span class="dv">100000</span>  <span class="sc">==</span> <span class="dv">500</span> <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span>  <span class="sc">~</span> number,</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span>   <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">10000</span>)   <span class="sc">*</span> <span class="dv">10000</span>   <span class="sc">==</span> <span class="dv">500</span> <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span>   <span class="sc">~</span> number,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span>    <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">1000</span>)    <span class="sc">*</span> <span class="dv">1000</span>    <span class="sc">==</span> <span class="dv">500</span> <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span>    <span class="sc">~</span> number,</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000</span>     <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">100</span>)     <span class="sc">*</span> <span class="dv">100</span>     <span class="sc">==</span> <span class="dv">50</span>  <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000</span>     <span class="sc">~</span> number,</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000</span>      <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">100</span>)     <span class="sc">*</span> <span class="dv">100</span>     <span class="sc">==</span> <span class="dv">50</span>  <span class="sc">~</span> number <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000</span>      <span class="sc">~</span> number,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100</span>       <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">10</span>)      <span class="sc">*</span> <span class="dv">10</span>      <span class="sc">==</span> <span class="dv">5</span>   <span class="sc">~</span> number <span class="sc">+</span> <span class="fl">0.01</span>,</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100</span>       <span class="sc">~</span> number,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10</span>        <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number <span class="sc">/</span> <span class="dv">1</span>)       <span class="sc">*</span> <span class="dv">1</span>       <span class="sc">==</span> <span class="fl">0.5</span> <span class="sc">~</span> number <span class="sc">+</span> <span class="fl">0.0001</span>,</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10</span>        <span class="sc">~</span> number,</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> number)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  numbertext <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">*</span><span class="dv">1000000</span> <span class="sc">&gt;=</span> <span class="dv">900</span> <span class="sc">~</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">*</span><span class="dv">1000000</span> <span class="sc">&gt;=</span> <span class="dv">700</span> <span class="sc">~</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"nearly "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">*</span><span class="dv">1000000</span> <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"more than "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">~</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>,    <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span> <span class="sc">&gt;=</span> <span class="dv">900</span> <span class="sc">~</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span> <span class="sc">&gt;=</span> <span class="dv">700</span> <span class="sc">~</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"nearly "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span> <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"more than "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000000</span> <span class="sc">~</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">100000</span>)<span class="sc">*</span><span class="dv">100000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">*</span><span class="dv">10000</span> <span class="sc">&gt;=</span> <span class="dv">900</span> <span class="sc">~</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">*</span><span class="dv">10000</span> <span class="sc">&gt;=</span> <span class="dv">700</span> <span class="sc">~</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"nearly "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">*</span><span class="dv">10000</span> <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"more than "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">*</span><span class="dv">10000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000000</span> <span class="sc">~</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">10000</span>)<span class="sc">*</span><span class="dv">10000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span><span class="dv">1000</span> <span class="sc">&gt;=</span> <span class="dv">900</span> <span class="sc">~</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span><span class="dv">1000</span> <span class="sc">&gt;=</span> <span class="dv">700</span> <span class="sc">~</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"nearly "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(number, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span> <span class="sc">&amp;</span> number <span class="sc">-</span> <span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span><span class="dv">1000</span> <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> </span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"more than "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span><span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100000</span> <span class="sc">~</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>(<span class="fu">signif</span>(<span class="fu">floor</span>(number<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span><span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>                               <span class="at">big.mark=</span><span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10000</span> <span class="sc">~</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>((<span class="fu">round</span>(number<span class="sc">/</span><span class="dv">100</span>, <span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>), <span class="at">big.mark=</span><span class="st">","</span>)),</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">~</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">format</span>((<span class="fu">round</span>(number<span class="sc">/</span><span class="dv">100</span>, <span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>), <span class="at">big.mark=</span><span class="st">","</span>)),</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">100</span> <span class="sc">~</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">round</span>(number<span class="sc">/</span><span class="dv">10</span>, <span class="dv">0</span>)<span class="sc">*</span><span class="dv">10</span>),</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">~</span> </span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around "</span>, <span class="fu">round</span>(number<span class="sc">/</span><span class="dv">5</span>, <span class="dv">0</span>)<span class="sc">*</span><span class="dv">5</span>),</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="fl">7.5</span> <span class="sc">~</span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around 10"</span>),</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>    number <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">~</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"around 5"</span>),</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"less than 5"</span>))</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(numbertext)</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## Urgent cancer referrals</span></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>The dataset for this came directly from NHS England and didn't need much cleaning. I initially did a few different models with different start dates</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model}</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: code for modelling</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a><span class="in">CWTUSC &lt;- read_xlsx("data/CWT-CRS-National-Time-Series-Oct-2009-Jun-2024-with-Revisions.xlsx", sheet = 5, range = "B4:C181") %&gt;%</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;%</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(monthly = as.Date(monthly))</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a><span class="in">## Modelling</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a><span class="in">USCR_predictions_ENG &lt;- CWTUSC %&gt;%</span></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(month_no = 1:nrow(CWTUSC)) %&gt;%</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a><span class="in">  select(monthly, total) %&gt;%</span></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(monthly)</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="in">future_dates &lt;- data.frame(</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a><span class="in">  monthly = seq.Date(from = max(CWTUSC$monthly) + months(1), by = "month", length.out = 69)</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a><span class="in">USCR_predictions_ENG &lt;- bind_rows(USCR_predictions_ENG, future_dates) #%&gt;% select(-4)</span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a><span class="in">total_model &lt;- glm(total ~ monthly, gaussian(), data = USCR_predictions_ENG %&gt;% filter(!is.na(total)))</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a><span class="in">total_model_from19 &lt;- glm(total ~ monthly, gaussian(), data = USCR_predictions_ENG %&gt;% filter(!is.na(total) &amp; monthly &gt; "2019-01-01"))</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a><span class="in">total_model_from21 &lt;- glm(total ~ monthly, gaussian(), data = USCR_predictions_ENG %&gt;% filter(!is.na(total) &amp; monthly &gt; "2021-01-01"))</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a><span class="in">total_model_precovid &lt;- glm(total ~ monthly, gaussian(), data = USCR_predictions_ENG %&gt;% filter(!is.na(total) &amp; monthly &lt; "2020-03-01"))</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a><span class="in">#Make predictions</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a><span class="in">USCR_predictions_ENG &lt;- USCR_predictions_ENG %&gt;%</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_total = predict(total_model, newdata = USCR_predictions_ENG, type = "response"),</span></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_total_from19 = predict(total_model_from19, newdata = USCR_predictions_ENG, type = "response"),</span></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_total_from21 = predict(total_model_from21, newdata = USCR_predictions_ENG, type = "response"),</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_total_precovid = predict(total_model_precovid, newdata = USCR_predictions_ENG, type = "response"),</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r aggregate_numbers}</span></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a><span class="in">## To get new aggregate number</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a><span class="in">England_USC_prediction &lt;- USCR_predictions_ENG %&gt;%</span></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(monthly &gt; "2024-06-01" &amp; monthly &lt; "2029-07-01") %&gt;%</span></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_referrals_09 = sum(predicted_total),</span></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a><span class="in">    rounded_09 = CRUKRoundingPerYear(predicted_referrals_09),</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_referrals_19 = sum(predicted_total_from19),</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_referrals_21 = sum(predicted_total_from21),</span></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a><span class="in">    predicted_referrals_precovid = sum(predicted_total_precovid)</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a><span class="in">AnnualPercChange &lt;- USCR_predictions_ENG %&gt;%</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a><span class="in">  #mutate(year = as.numeric(format(date,'%Y'))) %&gt;%</span></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(monthly &gt;= "2023-07-01" &amp; monthly &lt; "2029-07-01") %&gt;%</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(year = case_when(monthly &gt; "2023-06-01" &amp; monthly &lt; "2024-07-01"  ~ "2023/24",</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a><span class="in">                          monthly &gt; "2024-06-01" &amp; monthly &lt; "2025-07-01"  ~ "2024/25",</span></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a><span class="in">                          monthly &gt; "2025-06-01" &amp; monthly &lt; "2026-07-01"  ~ "2025/26",</span></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a><span class="in">                          monthly &gt; "2026-06-01" &amp; monthly &lt; "2027-07-01"  ~ "2026/27",</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a><span class="in">                          monthly &gt; "2027-06-01" &amp; monthly &lt; "2028-07-01"  ~ "2027/28",</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a><span class="in">                          monthly &gt; "2028-06-01" &amp; monthly &lt; "2029-07-01"  ~ "2028/29")) %&gt;%</span></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year) %&gt;%</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(total = coalesce(total, predicted_total)) %&gt;%</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(total = sum(total))</span></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a><span class="in">AnnualPercChange &lt;- AnnualPercChange %&gt;%</span></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percent_inc = total / AnnualPercChange[AnnualPercChange$year == "2023/24",]$total * 100,</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a><span class="in">         count_diff = total - lag(total, n = 1L),</span></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a><span class="in">         perc_diff = percent_inc - lag(percent_inc, n = 1L),</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a><span class="in">         yearno = row_number())</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a><span class="in">#increase in referrals at the end of term compared to 23/24</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a><span class="in">USCPercChange &lt;- round((AnnualPercChange[AnnualPercChange$year == "2028/29",]$total / AnnualPercChange[AnnualPercChange$year == "2023/24",]$total - 1) *100, 0)</span></span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a><span class="in">#Number</span></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a><span class="in">ExtraReferrals &lt;- (AnnualPercChange[AnnualPercChange$year == "2028/29",]$total - AnnualPercChange[AnnualPercChange$year == "2023/24",]$total)</span></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>By 2029, there are expected to be <span class="in">`{r} USCPercChange`</span>% more urgent cancer referrals than there were during the last year, which would be <span class="in">`{r} CRUKRoundingPerYear(ExtraReferrals)`</span> people being referred for urgent suspected cancer. </span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## 31 day waits</span></span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>CWT31 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/CWT_31day_Overall_2024-09-04.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="co"># From sst hub</span></span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a><span class="co"># England ---- </span></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a><span class="do">## Filtering and tidying names of main data</span></span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a><span class="do">## Going to use only First treatments to match historic and other nations data like picking USC route for 62 decision.</span></span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>CWT31ENG <span class="ot">&lt;-</span> CWT31 <span class="sc">%&gt;%</span></span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"England"</span> <span class="sc">&amp;</span> FirstOrSubsequent <span class="sc">==</span> <span class="st">"First Treatment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">-</span>Country, <span class="sc">-</span>FirstOrSubsequent) <span class="sc">%&gt;%</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(<span class="fu">floor_date</span>(<span class="fu">parse_date_time</span>(date, <span class="at">orders =</span> <span class="st">"my"</span>), <span class="at">unit =</span> <span class="st">"month"</span>)) <span class="sc">%&gt;%</span> <span class="fu">as.Date</span>(<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a><span class="do">## Modelling</span></span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>predictions_ENG <span class="ot">&lt;-</span> CWT31ENG <span class="sc">%&gt;%</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_no =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(CWT31ENG)) <span class="sc">%&gt;%</span></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(date, count, outside_target, month_no) <span class="sc">%&gt;%</span> </span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(date)</span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>future_dates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">max</span>(CWT31ENG<span class="sc">$</span>date) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">1</span>), <span class="at">by =</span> <span class="st">"month"</span>, <span class="at">length.out =</span> <span class="dv">69</span>),</span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>                           <span class="at">month_no =</span> <span class="fu">seq</span>(<span class="fu">max</span>(predictions_ENG<span class="sc">$</span>month_no) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">max</span>(predictions_ENG<span class="sc">$</span>month_no) <span class="sc">+</span> <span class="dv">69</span>, </span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">length.out=</span><span class="fu">length</span>((<span class="fu">max</span>(predictions_ENG<span class="sc">$</span>month_no)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">max</span>(predictions_ENG<span class="sc">$</span>month_no) <span class="sc">+</span> <span class="dv">69</span>))),</span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a>                           <span class="at">outside_target =</span> <span class="cn">NA</span>,</span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a>                           <span class="at">count =</span> <span class="cn">NA</span>)</span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a>predictions_ENG <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(predictions_ENG, future_dates)</span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Fits guassian regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>Model_31_2009 <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> date, <span class="fu">gaussian</span>(), <span class="at">data =</span> predictions_ENG <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(count)))</span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a>Model_31_2019 <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> date, <span class="fu">gaussian</span>(), <span class="at">data =</span> predictions_ENG <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(count) <span class="sc">&amp;</span> date <span class="sc">&gt;</span> <span class="st">"2019-01-01"</span>))</span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a>Model_31_2021 <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> date, <span class="fu">gaussian</span>(), <span class="at">data =</span> predictions_ENG <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(count) <span class="sc">&amp;</span> date <span class="sc">&gt;</span> <span class="st">"2021-01-01"</span>))</span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>Model_31_precovid <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> date, <span class="fu">gaussian</span>(), <span class="at">data =</span> predictions_ENG <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(count)<span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2020-03-01"</span>))</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a>predictions_ENG <span class="ot">&lt;-</span> predictions_ENG <span class="sc">%&gt;%</span> </span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_count_2009 =</span> <span class="fu">predict</span>(Model_31_2009, <span class="at">newdata =</span> predictions_ENG, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_count_2019 =</span> <span class="fu">predict</span>(Model_31_2019, <span class="at">newdata =</span> predictions_ENG, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_count_2021 =</span> <span class="fu">predict</span>(Model_31_2021, <span class="at">newdata =</span> predictions_ENG, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_count_precovid =</span> <span class="fu">predict</span>(Model_31_precovid, <span class="at">newdata =</span> predictions_ENG, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">performance =</span> <span class="dv">1</span><span class="sc">-</span>(outside_target<span class="sc">/</span>count),</span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a>         <span class="at">average_6m_count =</span> <span class="fu">rollmean</span>(count, <span class="dv">6</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true" tabindex="-1"></a>         <span class="at">average_6m_outside =</span> <span class="fu">rollmean</span>(outside_target, <span class="dv">6</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true" tabindex="-1"></a>         <span class="at">average_6m_perf =</span> <span class="dv">1</span><span class="sc">-</span>(average_6m_outside<span class="sc">/</span>average_6m_count),</span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a>         <span class="at">multiplier =</span> <span class="fu">last</span>(<span class="fu">na.omit</span>(average_6m_perf)))</span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a><span class="do">## To get new aggregate number</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a>predictions_ENG_summary <span class="ot">&lt;-</span> predictions_ENG <span class="sc">%&gt;%</span> </span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="st">"2024-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2029-07-01"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">predicted_count_2009 =</span> <span class="fu">sum</span>(predicted_count_2009),</span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_2019 =</span> <span class="fu">sum</span>(predicted_count_2019),</span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_2021 =</span> <span class="fu">sum</span>(predicted_count_2021),</span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_precovid =</span> <span class="fu">sum</span>(predicted_count_precovid))</span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a>England_outside <span class="ot">&lt;-</span> predictions_ENG <span class="sc">%&gt;%</span> </span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="st">"2024-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2029-07-01"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standard =</span> <span class="fl">0.95</span>,</span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>         <span class="at">additional_patients =</span> (standard <span class="sc">-</span> multiplier) <span class="sc">*</span> predicted_count_2009) <span class="sc">%&gt;%</span> <span class="co">#Adds in how many patients needed to meet target</span></span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">additional_patients =</span> <span class="fu">sum</span>(additional_patients)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a>EnglandAnnualFigures <span class="ot">&lt;-</span> predictions_ENG <span class="sc">%&gt;%</span></span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="st">'%Y'</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="st">"2023-07-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2029-07-01"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">case_when</span>(date <span class="sc">&gt;</span> <span class="st">"2023-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2024-07-01"</span> <span class="sc">~</span> <span class="st">"2023/24"</span>,</span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a>                          date <span class="sc">&gt;</span> <span class="st">"2024-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2025-07-01"</span> <span class="sc">~</span> <span class="st">"2024/25"</span>,</span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>                          date <span class="sc">&gt;</span> <span class="st">"2025-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2026-07-01"</span> <span class="sc">~</span> <span class="st">"2025/26"</span>,</span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a>                          date <span class="sc">&gt;</span> <span class="st">"2026-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2027-07-01"</span> <span class="sc">~</span> <span class="st">"2026/27"</span>,</span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a>                          date <span class="sc">&gt;</span> <span class="st">"2027-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2028-07-01"</span> <span class="sc">~</span> <span class="st">"2027/28"</span>,</span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true" tabindex="-1"></a>                          date <span class="sc">&gt;</span> <span class="st">"2028-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2029-07-01"</span> <span class="sc">~</span> <span class="st">"2028/29"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">coalesce</span>(count, predicted_count_2009)) <span class="sc">%&gt;%</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count))</span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: graph code</span></span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true" tabindex="-1"></a><span class="co">#graph</span></span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true" tabindex="-1"></a>eng_graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions_ENG, <span class="fu">aes</span>(date)) <span class="sc">+</span></span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(date, predicted_count_2009, </span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="fu">paste0</span>(<span class="st">"2009 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2009))), </span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span></span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG, date <span class="sc">&gt;</span> <span class="st">"2018-12-31"</span>),</span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(date, predicted_count_2019, </span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="fu">paste0</span>(<span class="st">"2019 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2019))), </span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span></span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG, date <span class="sc">&gt;</span> <span class="st">"2021-01-01"</span>),</span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(date, predicted_count_2021,</span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="fu">paste0</span>(<span class="st">"2021 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2021))), </span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span></span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, </span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2024-06-30"</span>), <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2024-06-30"</span>), </span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">15000</span>, <span class="at">yend =</span> <span class="dv">38000</span>,</span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">"#BBC7D9"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(date, count), <span class="at">linewidth=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb11-340"><a href="#cb11-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"England: 31-day model"</span>) <span class="sc">+</span></span>
<span id="cb11-341"><a href="#cb11-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-342"><a href="#cb11-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2010-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2029-06-30"</span>))) <span class="sc">+</span></span>
<span id="cb11-343"><a href="#cb11-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Model and prediction"</span>) <span class="sc">+</span> </span>
<span id="cb11-344"><a href="#cb11-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span>
<span id="cb11-345"><a href="#cb11-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-346"><a href="#cb11-346" aria-hidden="true" tabindex="-1"></a>eng_graph <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(predictions_ENG) <span class="sc">%&gt;%</span></span>
<span id="cb11-347"><a href="#cb11-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-348"><a href="#cb11-348" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_2009,</span>
<span id="cb11-349"><a href="#cb11-349" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2009 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2009), <span class="st">" people"</span>), </span>
<span id="cb11-350"><a href="#cb11-350" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#ff0087"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-351"><a href="#cb11-351" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-352"><a href="#cb11-352" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-353"><a href="#cb11-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG, date <span class="sc">&gt;=</span> <span class="st">"2019-01-01"</span>),</span>
<span id="cb11-354"><a href="#cb11-354" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-355"><a href="#cb11-355" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_2019,</span>
<span id="cb11-356"><a href="#cb11-356" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2019 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2019), <span class="st">" people"</span>), </span>
<span id="cb11-357"><a href="#cb11-357" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#009cee"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-358"><a href="#cb11-358" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG, date <span class="sc">&gt;=</span> <span class="st">"2021-01-01"</span>),</span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_2021,</span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2021 - "</span>, <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_2021), <span class="st">" people"</span>), </span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#00007e"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG, date <span class="sc">&gt;=</span> <span class="st">"2009-01-01"</span>),</span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>count,</span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"Historical data"</span>), </span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#000000"</span>), </span>
<span id="cb11-372"><a href="#cb11-372" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-373"><a href="#cb11-373" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-374"><a href="#cb11-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-375"><a href="#cb11-375" aria-hidden="true" tabindex="-1"></a>         <span class="at">toImageButtonOptions =</span> <span class="fu">list</span>(</span>
<span id="cb11-376"><a href="#cb11-376" aria-hidden="true" tabindex="-1"></a>           <span class="at">format =</span> <span class="st">"png"</span>,</span>
<span id="cb11-377"><a href="#cb11-377" aria-hidden="true" tabindex="-1"></a>           <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"England 31 day models"</span>),</span>
<span id="cb11-378"><a href="#cb11-378" aria-hidden="true" tabindex="-1"></a>           <span class="at">width =</span> <span class="dv">1400</span>,</span>
<span id="cb11-379"><a href="#cb11-379" aria-hidden="true" tabindex="-1"></a>           <span class="at">height =</span> <span class="dv">600</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-380"><a href="#cb11-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb11-381"><a href="#cb11-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb11-382"><a href="#cb11-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a>      <span class="at">orientation =</span> <span class="st">"h"</span>,</span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Model starting year and predicted number of patients over next parliamentary term"</span>,</span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a>                   <span class="at">font =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>                   <span class="at">side =</span> <span class="st">"top"</span>),</span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span>  <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>)</span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb11-391"><a href="#cb11-391" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Number of people"</span>, </span>
<span id="cb11-392"><a href="#cb11-392" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> T, </span>
<span id="cb11-393"><a href="#cb11-393" aria-hidden="true" tabindex="-1"></a>      <span class="at">zeroline =</span> T,</span>
<span id="cb11-394"><a href="#cb11-394" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickmode =</span> <span class="st">'auto'</span>,</span>
<span id="cb11-395"><a href="#cb11-395" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickformat =</span> <span class="st">'~s'</span>,</span>
<span id="cb11-396"><a href="#cb11-396" aria-hidden="true" tabindex="-1"></a>      <span class="at">nticks =</span> <span class="dv">5</span>,</span>
<span id="cb11-397"><a href="#cb11-397" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40000</span>),</span>
<span id="cb11-398"><a href="#cb11-398" aria-hidden="true" tabindex="-1"></a>      <span class="at">titlefont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb11-399"><a href="#cb11-399" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickfont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>)),</span>
<span id="cb11-400"><a href="#cb11-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb11-401"><a href="#cb11-401" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">""</span>, </span>
<span id="cb11-402"><a href="#cb11-402" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="st">"2010-01-01"</span>, <span class="st">"2030-01-01"</span>),</span>
<span id="cb11-403"><a href="#cb11-403" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickmode =</span> <span class="st">'auto'</span>,</span>
<span id="cb11-404"><a href="#cb11-404" aria-hidden="true" tabindex="-1"></a>      <span class="at">nticks =</span> <span class="dv">12</span>,</span>
<span id="cb11-405"><a href="#cb11-405" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> F, </span>
<span id="cb11-406"><a href="#cb11-406" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickfont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>),</span>
<span id="cb11-407"><a href="#cb11-407" aria-hidden="true" tabindex="-1"></a>      <span class="at">titlefont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>)),</span>
<span id="cb11-408"><a href="#cb11-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Number of people starting treatment on the 31-day pathway&lt;br&gt;&lt;sup&gt;England&lt;/sup&gt;"</span>, </span>
<span id="cb11-409"><a href="#cb11-409" aria-hidden="true" tabindex="-1"></a>                 <span class="at">font =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Progress Medium"</span>, </span>
<span id="cb11-410"><a href="#cb11-410" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"#000000"</span>,<span class="at">size =</span> <span class="dv">28</span>),</span>
<span id="cb11-411"><a href="#cb11-411" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xref =</span> <span class="st">'container'</span>,</span>
<span id="cb11-412"><a href="#cb11-412" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xanchor =</span> <span class="st">'left'</span>,</span>
<span id="cb11-413"><a href="#cb11-413" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> <span class="fl">0.01</span>),</span>
<span id="cb11-414"><a href="#cb11-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">t =</span> <span class="dv">80</span>, <span class="at">b =</span> <span class="dv">30</span>) <span class="co">#Set margin sizes with t, b, r, l. </span></span>
<span id="cb11-415"><a href="#cb11-415" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb11-416"><a href="#cb11-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-417"><a href="#cb11-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-418"><a href="#cb11-418" aria-hidden="true" tabindex="-1"></a>eng_graph</span>
<span id="cb11-419"><a href="#cb11-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-420"><a href="#cb11-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-421"><a href="#cb11-421" aria-hidden="true" tabindex="-1"></a><span class="fu">## 62 day wait</span></span>
<span id="cb11-422"><a href="#cb11-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-423"><a href="#cb11-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data_cleaning}</span></span>
<span id="cb11-424"><a href="#cb11-424" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62 &lt;- read_csv("data/CWT_62day_By cancer site_2024-09-05.csv", show_col_types = FALSE) # From sst hub</span></span>
<span id="cb11-425"><a href="#cb11-425" aria-hidden="true" tabindex="-1"></a><span class="in"># England ---- </span></span>
<span id="cb11-426"><a href="#cb11-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-427"><a href="#cb11-427" aria-hidden="true" tabindex="-1"></a><span class="in">## Filtering and tidying names of main data</span></span>
<span id="cb11-428"><a href="#cb11-428" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENG &lt;- CWT62 %&gt;%</span></span>
<span id="cb11-429"><a href="#cb11-429" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Country == "England" &amp; RefRoute == "Urgent Suspected Cancer") %&gt;%</span></span>
<span id="cb11-430"><a href="#cb11-430" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-Country) %&gt;%</span></span>
<span id="cb11-431"><a href="#cb11-431" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;%</span></span>
<span id="cb11-432"><a href="#cb11-432" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = format(floor_date(parse_date_time(date, orders = "my"), unit = "month")) %&gt;% as.Date(format = "%Y-%m-%d"))</span></span>
<span id="cb11-433"><a href="#cb11-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-434"><a href="#cb11-434" aria-hidden="true" tabindex="-1"></a><span class="in">## Old other routes data NB: all sites</span></span>
<span id="cb11-435"><a href="#cb11-435" aria-hidden="true" tabindex="-1"></a><span class="in">CWT_historic_other_routes_allsite &lt;- rbind(</span></span>
<span id="cb11-436"><a href="#cb11-436" aria-hidden="true" tabindex="-1"></a><span class="in">  (readxl::read_xlsx("data/Cancer-Waiting-Times-National-Time-Series-Oct-2009-Sep-2023-with-Revisions.xlsx", sheet = 2, range="AY4:BC172") %&gt;% mutate(ref_route = "Screening")), # </span></span>
<span id="cb11-437"><a href="#cb11-437" aria-hidden="true" tabindex="-1"></a><span class="in">  (readxl::read_xlsx("data/Cancer-Waiting-Times-National-Time-Series-Oct-2009-Sep-2023-with-Revisions.xlsx", sheet =2, range = "BF4:BJ172") %&gt;%  mutate(ref_route = "Consultant Upgrade"))</span></span>
<span id="cb11-438"><a href="#cb11-438" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb11-439"><a href="#cb11-439" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;% </span></span>
<span id="cb11-440"><a href="#cb11-440" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = as.Date(monthly, format = "%Y-%m-%d"),</span></span>
<span id="cb11-441"><a href="#cb11-441" aria-hidden="true" tabindex="-1"></a><span class="in">         factor = "All") %&gt;% </span></span>
<span id="cb11-442"><a href="#cb11-442" aria-hidden="true" tabindex="-1"></a><span class="in">  select(date, factor, ref_route, total, within_standard, outside_standard) %&gt;%</span></span>
<span id="cb11-443"><a href="#cb11-443" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(date, ref_route, factor) %&gt;%</span></span>
<span id="cb11-444"><a href="#cb11-444" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb11-445"><a href="#cb11-445" aria-hidden="true" tabindex="-1"></a><span class="in">    count = round_half_up(sum(total)),</span></span>
<span id="cb11-446"><a href="#cb11-446" aria-hidden="true" tabindex="-1"></a><span class="in">    within_target = round_half_up(sum(within_standard)),</span></span>
<span id="cb11-447"><a href="#cb11-447" aria-hidden="true" tabindex="-1"></a><span class="in">    outside_target = round_half_up(sum(outside_standard)),</span></span>
<span id="cb11-448"><a href="#cb11-448" aria-hidden="true" tabindex="-1"></a><span class="in">    percent_within_target = within_target / count</span></span>
<span id="cb11-449"><a href="#cb11-449" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb11-450"><a href="#cb11-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-451"><a href="#cb11-451" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENG &lt;- bind_rows(CWT62ENG, CWT_historic_other_routes_allsite)</span></span>
<span id="cb11-452"><a href="#cb11-452" aria-hidden="true" tabindex="-1"></a><span class="in">rm(CWT_historic_other_routes_allsite)</span></span>
<span id="cb11-453"><a href="#cb11-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-454"><a href="#cb11-454" aria-hidden="true" tabindex="-1"></a><span class="in">#Sep23-recent new routes data </span></span>
<span id="cb11-455"><a href="#cb11-455" aria-hidden="true" tabindex="-1"></a><span class="in">newroutes_data &lt;- read_csv("data/CWT_62day_By cancer site_2024-09-05.csv", show_col_types = FALSE) %&gt;% </span></span>
<span id="cb11-456"><a href="#cb11-456" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;% </span></span>
<span id="cb11-457"><a href="#cb11-457" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(ref_route %in% c("Consultant Upgrade", "Screening") | date %in% c("Oct-23", "Nov-23", "Dec-23", "Jan-24", "Feb-24", "Mar-24", "Apr-24", "May-24", "Jun-24")) %&gt;% </span></span>
<span id="cb11-458"><a href="#cb11-458" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!factor %in% c("Urological (excl. prostate)","Prostate", "Gynaecological", "Lymphoma", "Haematological (excl. lymphoma)", "Head and neck", "Other (new grouping)", "Oesophagus and stomach", "Hepatobiliary") ) %&gt;% #download includes both separate and combined routes for other and uro so below can remove the separate new sites</span></span>
<span id="cb11-459"><a href="#cb11-459" aria-hidden="true" tabindex="-1"></a><span class="in">  select(date, ref_route, total = count, within_target, outside_target)%&gt;% </span></span>
<span id="cb11-460"><a href="#cb11-460" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = format(floor_date(parse_date_time(date, orders = "my"), unit = "month")) %&gt;% as.Date(format = "%Y-%m-%d"),</span></span>
<span id="cb11-461"><a href="#cb11-461" aria-hidden="true" tabindex="-1"></a><span class="in">         factor = "All") %&gt;% </span></span>
<span id="cb11-462"><a href="#cb11-462" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(date, ref_route, factor) %&gt;%</span></span>
<span id="cb11-463"><a href="#cb11-463" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb11-464"><a href="#cb11-464" aria-hidden="true" tabindex="-1"></a><span class="in">    count = round_half_up(sum(total)),</span></span>
<span id="cb11-465"><a href="#cb11-465" aria-hidden="true" tabindex="-1"></a><span class="in">    within_target = round_half_up(sum(within_target)),</span></span>
<span id="cb11-466"><a href="#cb11-466" aria-hidden="true" tabindex="-1"></a><span class="in">    outside_target = round_half_up(sum(outside_target)),</span></span>
<span id="cb11-467"><a href="#cb11-467" aria-hidden="true" tabindex="-1"></a><span class="in">    percent_within_target = within_target / count</span></span>
<span id="cb11-468"><a href="#cb11-468" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb11-469"><a href="#cb11-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-470"><a href="#cb11-470" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENG &lt;- bind_rows(CWT62ENG, newroutes_data)</span></span>
<span id="cb11-471"><a href="#cb11-471" aria-hidden="true" tabindex="-1"></a><span class="in">rm(newroutes_data)</span></span>
<span id="cb11-472"><a href="#cb11-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-473"><a href="#cb11-473" aria-hidden="true" tabindex="-1"></a><span class="in">## Fixing site names and grouping</span></span>
<span id="cb11-474"><a href="#cb11-474" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENG &lt;- CWT62ENG %&gt;%</span></span>
<span id="cb11-475"><a href="#cb11-475" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-standard_hit, -additional_patients, -target_last_met, -rank, -standard) %&gt;%</span></span>
<span id="cb11-476"><a href="#cb11-476" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!factor %in% c("Urological (excl. prostate)", "Prostate", </span></span>
<span id="cb11-477"><a href="#cb11-477" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Gynaecological", "Lymphoma", "Haematological (excl. lymphoma)", </span></span>
<span id="cb11-478"><a href="#cb11-478" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Head and neck", "Other (new grouping)", "Oesophagus and stomach", </span></span>
<span id="cb11-479"><a href="#cb11-479" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Hepatobiliary") ) %&gt;% #download includes both separate and combined routes for other and uro so below can remove the separate new sites</span></span>
<span id="cb11-480"><a href="#cb11-480" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(factor, ref_route, date) %&gt;%</span></span>
<span id="cb11-481"><a href="#cb11-481" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb11-482"><a href="#cb11-482" aria-hidden="true" tabindex="-1"></a><span class="in">    count = sum(count),</span></span>
<span id="cb11-483"><a href="#cb11-483" aria-hidden="true" tabindex="-1"></a><span class="in">    within_target = sum(within_target),</span></span>
<span id="cb11-484"><a href="#cb11-484" aria-hidden="true" tabindex="-1"></a><span class="in">    outside_target = round_half_up(sum(outside_target), digits = 0),</span></span>
<span id="cb11-485"><a href="#cb11-485" aria-hidden="true" tabindex="-1"></a><span class="in">    percent_within_target = within_target / count</span></span>
<span id="cb11-486"><a href="#cb11-486" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb11-487"><a href="#cb11-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-488"><a href="#cb11-488" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENG$ref_route &lt;- make_clean_names(CWT62ENG$ref_route, allow_dupes = TRUE)</span></span>
<span id="cb11-489"><a href="#cb11-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-490"><a href="#cb11-490" aria-hidden="true" tabindex="-1"></a><span class="in">##Split into list with each element a df a site subset</span></span>
<span id="cb11-491"><a href="#cb11-491" aria-hidden="true" tabindex="-1"></a><span class="in">CWT62ENGsplit &lt;- CWT62ENG %&gt;%</span></span>
<span id="cb11-492"><a href="#cb11-492" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ref_route, factor) %&gt;%</span></span>
<span id="cb11-493"><a href="#cb11-493" aria-hidden="true" tabindex="-1"></a><span class="in">  group_split(.keep = FALSE)</span></span>
<span id="cb11-494"><a href="#cb11-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-495"><a href="#cb11-495" aria-hidden="true" tabindex="-1"></a><span class="in">##Adding names to each df list element</span></span>
<span id="cb11-496"><a href="#cb11-496" aria-hidden="true" tabindex="-1"></a><span class="in">names(CWT62ENGsplit) &lt;- CWT62ENG %&gt;%</span></span>
<span id="cb11-497"><a href="#cb11-497" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ref_route, factor) %&gt;%</span></span>
<span id="cb11-498"><a href="#cb11-498" aria-hidden="true" tabindex="-1"></a><span class="in">  group_keys() %&gt;%</span></span>
<span id="cb11-499"><a href="#cb11-499" aria-hidden="true" tabindex="-1"></a><span class="in">  unite("name", ref_route:factor, sep = ":") %&gt;%</span></span>
<span id="cb11-500"><a href="#cb11-500" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(name)</span></span>
<span id="cb11-501"><a href="#cb11-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-502"><a href="#cb11-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-503"><a href="#cb11-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r modelling}</span></span>
<span id="cb11-504"><a href="#cb11-504" aria-hidden="true" tabindex="-1"></a><span class="in">## Modelling</span></span>
<span id="cb11-505"><a href="#cb11-505" aria-hidden="true" tabindex="-1"></a><span class="in">predictions_ENG &lt;- CWT62ENGsplit %&gt;%</span></span>
<span id="cb11-506"><a href="#cb11-506" aria-hidden="true" tabindex="-1"></a><span class="in">  enframe(name = "list", value = "data") %&gt;% # converts lists to single df</span></span>
<span id="cb11-507"><a href="#cb11-507" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb11-508"><a href="#cb11-508" aria-hidden="true" tabindex="-1"></a><span class="in">    # function to add 60 blank months to each df list element</span></span>
<span id="cb11-509"><a href="#cb11-509" aria-hidden="true" tabindex="-1"></a><span class="in">    data = map(data, \(df){ </span></span>
<span id="cb11-510"><a href="#cb11-510" aria-hidden="true" tabindex="-1"></a><span class="in">      df &lt;- df %&gt;%</span></span>
<span id="cb11-511"><a href="#cb11-511" aria-hidden="true" tabindex="-1"></a><span class="in">        mutate(date = as.Date(date),</span></span>
<span id="cb11-512"><a href="#cb11-512" aria-hidden="true" tabindex="-1"></a><span class="in">               month_no = 1:nrow(df)) %&gt;%</span></span>
<span id="cb11-513"><a href="#cb11-513" aria-hidden="true" tabindex="-1"></a><span class="in">        select(date, count, outside_target, month_no) %&gt;% </span></span>
<span id="cb11-514"><a href="#cb11-514" aria-hidden="true" tabindex="-1"></a><span class="in">        arrange(date)</span></span>
<span id="cb11-515"><a href="#cb11-515" aria-hidden="true" tabindex="-1"></a><span class="in">      last_date &lt;- max(df$date)</span></span>
<span id="cb11-516"><a href="#cb11-516" aria-hidden="true" tabindex="-1"></a><span class="in">      last_no &lt;- max(df$month_no)</span></span>
<span id="cb11-517"><a href="#cb11-517" aria-hidden="true" tabindex="-1"></a><span class="in">      #future_dates &lt;- seq.Date(from = last_date + months(1), by = "month", length.out = 60)</span></span>
<span id="cb11-518"><a href="#cb11-518" aria-hidden="true" tabindex="-1"></a><span class="in">      future_dates &lt;- data.frame(date = seq.Date(from = last_date + months(1), by = "month", length.out = 69),</span></span>
<span id="cb11-519"><a href="#cb11-519" aria-hidden="true" tabindex="-1"></a><span class="in">                                 month_no = seq(last_no + 1,</span></span>
<span id="cb11-520"><a href="#cb11-520" aria-hidden="true" tabindex="-1"></a><span class="in">                                                last_no + 69, </span></span>
<span id="cb11-521"><a href="#cb11-521" aria-hidden="true" tabindex="-1"></a><span class="in">                                                length.out=length((last_no+1):(last_no + 69))),</span></span>
<span id="cb11-522"><a href="#cb11-522" aria-hidden="true" tabindex="-1"></a><span class="in">                                 outside_target = NA,</span></span>
<span id="cb11-523"><a href="#cb11-523" aria-hidden="true" tabindex="-1"></a><span class="in">                                 count = NA)</span></span>
<span id="cb11-524"><a href="#cb11-524" aria-hidden="true" tabindex="-1"></a><span class="in">      bind_rows(df, future_dates)</span></span>
<span id="cb11-525"><a href="#cb11-525" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb11-526"><a href="#cb11-526" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb11-527"><a href="#cb11-527" aria-hidden="true" tabindex="-1"></a><span class="in">    # Fits gaussian regression models to each list element using non NA i.e. historic data for COUNT in order to be used to offset the outside_target model</span></span>
<span id="cb11-528"><a href="#cb11-528" aria-hidden="true" tabindex="-1"></a><span class="in">    count_model_09 = map(data, \(df) glm(count ~ month_no, gaussian(), data = df %&gt;% filter(!is.na(count)))),</span></span>
<span id="cb11-529"><a href="#cb11-529" aria-hidden="true" tabindex="-1"></a><span class="in">    count_model_19 = map(data, \(df) glm(count ~ month_no, gaussian(), data = df %&gt;% filter(!is.na(count) &amp; date &gt; "2019-01-01"))),</span></span>
<span id="cb11-530"><a href="#cb11-530" aria-hidden="true" tabindex="-1"></a><span class="in">    count_model_21 = map(data, \(df) glm(count ~ month_no, gaussian(), data = df %&gt;% filter(!is.na(count) &amp; date &gt; "2021-01-01"))),</span></span>
<span id="cb11-531"><a href="#cb11-531" aria-hidden="true" tabindex="-1"></a><span class="in">    count_model_precovid = map(data, \(df) glm(count ~ month_no, gaussian(), data = df %&gt;% filter(!is.na(count) &amp; date &lt; "2020-03-01"))),</span></span>
<span id="cb11-532"><a href="#cb11-532" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb11-533"><a href="#cb11-533" aria-hidden="true" tabindex="-1"></a><span class="in">    # function to use the models to predict the NA rows for count</span></span>
<span id="cb11-534"><a href="#cb11-534" aria-hidden="true" tabindex="-1"></a><span class="in">    data = map2(count_model_09, data, \(mod, df) { </span></span>
<span id="cb11-535"><a href="#cb11-535" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- df</span></span>
<span id="cb11-536"><a href="#cb11-536" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_09 &lt;- predict(mod, newdata = data, type = "response")</span></span>
<span id="cb11-537"><a href="#cb11-537" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_09 &lt;- data$predicted_count_09</span></span>
<span id="cb11-538"><a href="#cb11-538" aria-hidden="true" tabindex="-1"></a><span class="in">     # data$predicted_count_09[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span id="cb11-539"><a href="#cb11-539" aria-hidden="true" tabindex="-1"></a><span class="in">      data</span></span>
<span id="cb11-540"><a href="#cb11-540" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb11-541"><a href="#cb11-541" aria-hidden="true" tabindex="-1"></a><span class="in">    data = map2(count_model_19, data, \(mod, df) { </span></span>
<span id="cb11-542"><a href="#cb11-542" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- df</span></span>
<span id="cb11-543"><a href="#cb11-543" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_19 &lt;- predict(mod, newdata = data, type = "response")</span></span>
<span id="cb11-544"><a href="#cb11-544" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_19 &lt;- data$predicted_count_19</span></span>
<span id="cb11-545"><a href="#cb11-545" aria-hidden="true" tabindex="-1"></a><span class="in">     # data$predicted_count_19[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span id="cb11-546"><a href="#cb11-546" aria-hidden="true" tabindex="-1"></a><span class="in">      data</span></span>
<span id="cb11-547"><a href="#cb11-547" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb11-548"><a href="#cb11-548" aria-hidden="true" tabindex="-1"></a><span class="in">    data = map2(count_model_21, data, \(mod, df) { </span></span>
<span id="cb11-549"><a href="#cb11-549" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- df</span></span>
<span id="cb11-550"><a href="#cb11-550" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_21 &lt;- predict(mod, newdata = data, type = "response")</span></span>
<span id="cb11-551"><a href="#cb11-551" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_21 &lt;- data$predicted_count_21</span></span>
<span id="cb11-552"><a href="#cb11-552" aria-hidden="true" tabindex="-1"></a><span class="in">      #data$predicted_count_21[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span id="cb11-553"><a href="#cb11-553" aria-hidden="true" tabindex="-1"></a><span class="in">      data</span></span>
<span id="cb11-554"><a href="#cb11-554" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb11-555"><a href="#cb11-555" aria-hidden="true" tabindex="-1"></a><span class="in">    data = map2(count_model_precovid, data, \(mod, df) { </span></span>
<span id="cb11-556"><a href="#cb11-556" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- df</span></span>
<span id="cb11-557"><a href="#cb11-557" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_precovid &lt;- predict(mod, newdata = data, type = "response")</span></span>
<span id="cb11-558"><a href="#cb11-558" aria-hidden="true" tabindex="-1"></a><span class="in">      data$predicted_count_precovid &lt;- data$predicted_count_precovid</span></span>
<span id="cb11-559"><a href="#cb11-559" aria-hidden="true" tabindex="-1"></a><span class="in">      #data$predicted_count_precovid[!is.na(data$count)] &lt;- NA #Remove predictions for data we already have as redundant</span></span>
<span id="cb11-560"><a href="#cb11-560" aria-hidden="true" tabindex="-1"></a><span class="in">      data</span></span>
<span id="cb11-561"><a href="#cb11-561" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb11-562"><a href="#cb11-562" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb11-563"><a href="#cb11-563" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(data) %&gt;% </span></span>
<span id="cb11-564"><a href="#cb11-564" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-count_model_09, -count_model_19, count_model_21, count_model_precovid) %&gt;% </span></span>
<span id="cb11-565"><a href="#cb11-565" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(list) %&gt;% </span></span>
<span id="cb11-566"><a href="#cb11-566" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(performance = 1-(outside_target/count),</span></span>
<span id="cb11-567"><a href="#cb11-567" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_count = rollmean(count, 6, fill = NA, align = "right"),</span></span>
<span id="cb11-568"><a href="#cb11-568" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_outside = rollmean(outside_target, 6, fill = NA, align = "right"),</span></span>
<span id="cb11-569"><a href="#cb11-569" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_perf = 1-(average_6m_outside/average_6m_count),</span></span>
<span id="cb11-570"><a href="#cb11-570" aria-hidden="true" tabindex="-1"></a><span class="in">         multiplier = last(na.omit(average_6m_perf))) %&gt;% </span></span>
<span id="cb11-571"><a href="#cb11-571" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb11-572"><a href="#cb11-572" aria-hidden="true" tabindex="-1"></a><span class="in">  separate(list, sep = ":", into = c("ref_route", "cancer_type")) %&gt;% </span></span>
<span id="cb11-573"><a href="#cb11-573" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(predicted_outside = predicted_count_09 * (1-multiplier))</span></span>
<span id="cb11-574"><a href="#cb11-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-575"><a href="#cb11-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-576"><a href="#cb11-576" aria-hidden="true" tabindex="-1"></a><span class="in">## TO see last X period averages: </span></span>
<span id="cb11-577"><a href="#cb11-577" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions_ENG %&gt;% filter(date == "2024-06-01") </span></span>
<span id="cb11-578"><a href="#cb11-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-579"><a href="#cb11-579" aria-hidden="true" tabindex="-1"></a><span class="in">## To get new aggregate number</span></span>
<span id="cb11-580"><a href="#cb11-580" aria-hidden="true" tabindex="-1"></a><span class="in">#Projected patients starting treatment over 5 years</span></span>
<span id="cb11-581"><a href="#cb11-581" aria-hidden="true" tabindex="-1"></a><span class="in">England_count &lt;- sum(filter(predictions_ENG, date &gt;= "2024-07-01" &amp; date &lt; "2029-07-01")$predicted_count_09, na.rm = TRUE)</span></span>
<span id="cb11-582"><a href="#cb11-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-583"><a href="#cb11-583" aria-hidden="true" tabindex="-1"></a><span class="in">#Projected number of patients needed to meet target</span></span>
<span id="cb11-584"><a href="#cb11-584" aria-hidden="true" tabindex="-1"></a><span class="in">England_outside &lt;- predictions_ENG %&gt;% </span></span>
<span id="cb11-585"><a href="#cb11-585" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(date &gt; "2024-06-01" &amp; date &lt; "2029-07-01") %&gt;%</span></span>
<span id="cb11-586"><a href="#cb11-586" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(standard = 0.85,</span></span>
<span id="cb11-587"><a href="#cb11-587" aria-hidden="true" tabindex="-1"></a><span class="in">         additional_patients = (standard - multiplier) * predicted_count_09) %&gt;% #Adds in how many patients needed to meet target</span></span>
<span id="cb11-588"><a href="#cb11-588" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(additional_patients = sum(additional_patients)) %&gt;% </span></span>
<span id="cb11-589"><a href="#cb11-589" aria-hidden="true" tabindex="-1"></a><span class="in">  pull()</span></span>
<span id="cb11-590"><a href="#cb11-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-591"><a href="#cb11-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-592"><a href="#cb11-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-593"><a href="#cb11-593" aria-hidden="true" tabindex="-1"></a><span class="in">predictions_ENG_all &lt;- predictions_ENG %&gt;% mutate(country = "England") %&gt;%</span></span>
<span id="cb11-594"><a href="#cb11-594" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(date, month_no, country) %&gt;%</span></span>
<span id="cb11-595"><a href="#cb11-595" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count = sum(count),</span></span>
<span id="cb11-596"><a href="#cb11-596" aria-hidden="true" tabindex="-1"></a><span class="in">            outside_target = sum(outside_target),</span></span>
<span id="cb11-597"><a href="#cb11-597" aria-hidden="true" tabindex="-1"></a><span class="in">            predicted_count_09 = sum(predicted_count_09),</span></span>
<span id="cb11-598"><a href="#cb11-598" aria-hidden="true" tabindex="-1"></a><span class="in">            predicted_count_19 = sum(predicted_count_19),</span></span>
<span id="cb11-599"><a href="#cb11-599" aria-hidden="true" tabindex="-1"></a><span class="in">            predicted_count_21 = sum(predicted_count_21),</span></span>
<span id="cb11-600"><a href="#cb11-600" aria-hidden="true" tabindex="-1"></a><span class="in">            predicted_count_precovid = sum(predicted_count_precovid)) %&gt;%</span></span>
<span id="cb11-601"><a href="#cb11-601" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb11-602"><a href="#cb11-602" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(performance = 1-(outside_target/count),</span></span>
<span id="cb11-603"><a href="#cb11-603" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_count = rollmean(count, 6, fill = NA, align = "right"),</span></span>
<span id="cb11-604"><a href="#cb11-604" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_outside = rollmean(outside_target, 6, fill = NA, align = "right"),</span></span>
<span id="cb11-605"><a href="#cb11-605" aria-hidden="true" tabindex="-1"></a><span class="in">         average_6m_perf = 1-(average_6m_outside/average_6m_count),</span></span>
<span id="cb11-606"><a href="#cb11-606" aria-hidden="true" tabindex="-1"></a><span class="in">         multiplier = last(na.omit(average_6m_perf))) %&gt;% </span></span>
<span id="cb11-607"><a href="#cb11-607" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(predicted_outside = predicted_count_09 * (1-multiplier),</span></span>
<span id="cb11-608"><a href="#cb11-608" aria-hidden="true" tabindex="-1"></a><span class="in">         ref_route = NA,</span></span>
<span id="cb11-609"><a href="#cb11-609" aria-hidden="true" tabindex="-1"></a><span class="in">         cancer_type = "All")</span></span>
<span id="cb11-610"><a href="#cb11-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-611"><a href="#cb11-611" aria-hidden="true" tabindex="-1"></a><span class="in"># Annual change figure for England ------</span></span>
<span id="cb11-612"><a href="#cb11-612" aria-hidden="true" tabindex="-1"></a><span class="in"># Spoke with Sam on this one, and he suggested that the normal way to get a </span></span>
<span id="cb11-613"><a href="#cb11-613" aria-hidden="true" tabindex="-1"></a><span class="in"># percentage change is to do a quick glm and get the coefficient. Didn't use our</span></span>
<span id="cb11-614"><a href="#cb11-614" aria-hidden="true" tabindex="-1"></a><span class="in"># actual model because we wanted it to be compared to 2023/24 instead of the full</span></span>
<span id="cb11-615"><a href="#cb11-615" aria-hidden="true" tabindex="-1"></a><span class="in"># trend. Poisson model is here because we played with that out of interest, but</span></span>
<span id="cb11-616"><a href="#cb11-616" aria-hidden="true" tabindex="-1"></a><span class="in"># it basically came to a similar number anyways. Going with 2.3% as our yearly change.</span></span>
<span id="cb11-617"><a href="#cb11-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-618"><a href="#cb11-618" aria-hidden="true" tabindex="-1"></a><span class="in">EnglandAnnualFigures &lt;- predictions_ENG_all %&gt;%</span></span>
<span id="cb11-619"><a href="#cb11-619" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(year = as.numeric(format(date,'%Y'))) %&gt;%</span></span>
<span id="cb11-620"><a href="#cb11-620" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(date &gt;= "2023-07-01" &amp; date &lt; "2029-07-01") %&gt;%</span></span>
<span id="cb11-621"><a href="#cb11-621" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(year = case_when(date &gt; "2023-06-01" &amp; date &lt; "2024-07-01"  ~ "2023/24",</span></span>
<span id="cb11-622"><a href="#cb11-622" aria-hidden="true" tabindex="-1"></a><span class="in">                          date &gt; "2024-06-01" &amp; date &lt; "2025-07-01" ~ "2024/25",</span></span>
<span id="cb11-623"><a href="#cb11-623" aria-hidden="true" tabindex="-1"></a><span class="in">                          date &gt; "2025-06-01" &amp; date &lt; "2026-07-01"  ~ "2025/26",</span></span>
<span id="cb11-624"><a href="#cb11-624" aria-hidden="true" tabindex="-1"></a><span class="in">                          date &gt; "2026-06-01" &amp; date &lt; "2027-07-01"  ~ "2026/27",</span></span>
<span id="cb11-625"><a href="#cb11-625" aria-hidden="true" tabindex="-1"></a><span class="in">                          date &gt; "2027-06-01" &amp; date &lt; "2028-07-01"  ~ "2027/28",</span></span>
<span id="cb11-626"><a href="#cb11-626" aria-hidden="true" tabindex="-1"></a><span class="in">                          date &gt; "2028-06-01" &amp; date &lt; "2029-07-01"  ~ "2028/29")) %&gt;%</span></span>
<span id="cb11-627"><a href="#cb11-627" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year) %&gt;%</span></span>
<span id="cb11-628"><a href="#cb11-628" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(count = coalesce(count, predicted_count_09)) %&gt;%</span></span>
<span id="cb11-629"><a href="#cb11-629" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count = sum(count))</span></span>
<span id="cb11-630"><a href="#cb11-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-631"><a href="#cb11-631" aria-hidden="true" tabindex="-1"></a><span class="in">EnglandAnnualFigures &lt;- EnglandAnnualFigures %&gt;%</span></span>
<span id="cb11-632"><a href="#cb11-632" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percent_inc = count / EnglandAnnualFigures[EnglandAnnualFigures$year == "2023/24",]$count * 100,</span></span>
<span id="cb11-633"><a href="#cb11-633" aria-hidden="true" tabindex="-1"></a><span class="in">         count_diff = count - lag(count, n = 1L),</span></span>
<span id="cb11-634"><a href="#cb11-634" aria-hidden="true" tabindex="-1"></a><span class="in">         perc_diff = percent_inc - lag(percent_inc, n = 1L),</span></span>
<span id="cb11-635"><a href="#cb11-635" aria-hidden="true" tabindex="-1"></a><span class="in">         yearno = row_number())</span></span>
<span id="cb11-636"><a href="#cb11-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-637"><a href="#cb11-637" aria-hidden="true" tabindex="-1"></a><span class="in">YearInc &lt;- glm(log(count) ~ yearno, gaussian(), data = EnglandAnnualFigures)</span></span>
<span id="cb11-638"><a href="#cb11-638" aria-hidden="true" tabindex="-1"></a><span class="in">#The annual %age increase</span></span>
<span id="cb11-639"><a href="#cb11-639" aria-hidden="true" tabindex="-1"></a><span class="in">coef &lt;- (exp(YearInc$coef[2])-1)*100  </span></span>
<span id="cb11-640"><a href="#cb11-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-641"><a href="#cb11-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-642"><a href="#cb11-642" aria-hidden="true" tabindex="-1"></a><span class="in">EnglandAnnualFigures &lt;- EnglandAnnualFigures %&gt;%</span></span>
<span id="cb11-643"><a href="#cb11-643" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(increase = (coef / 100) * lag(count, n = 1L),</span></span>
<span id="cb11-644"><a href="#cb11-644" aria-hidden="true" tabindex="-1"></a><span class="in">         new_total = count+ increase)</span></span>
<span id="cb11-645"><a href="#cb11-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-646"><a href="#cb11-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-649"><a href="#cb11-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-650"><a href="#cb11-650" aria-hidden="true" tabindex="-1"></a>predictions_ENG_summary <span class="ot">&lt;-</span> predictions_ENG_all <span class="sc">%&gt;%</span> </span>
<span id="cb11-651"><a href="#cb11-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="st">"2024-06-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="st">"2029-07-01"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-652"><a href="#cb11-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">predicted_count_09 =</span> <span class="fu">sum</span>(predicted_count_09),</span>
<span id="cb11-653"><a href="#cb11-653" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_19 =</span> <span class="fu">sum</span>(predicted_count_19),</span>
<span id="cb11-654"><a href="#cb11-654" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_21 =</span> <span class="fu">sum</span>(predicted_count_21),</span>
<span id="cb11-655"><a href="#cb11-655" aria-hidden="true" tabindex="-1"></a>            <span class="at">predicted_count_precovid =</span> <span class="fu">sum</span>(predicted_count_precovid))</span>
<span id="cb11-656"><a href="#cb11-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-657"><a href="#cb11-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-660"><a href="#cb11-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-661"><a href="#cb11-661" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(predictions_ENG_all) <span class="sc">%&gt;%</span></span>
<span id="cb11-662"><a href="#cb11-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-663"><a href="#cb11-663" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_09,</span>
<span id="cb11-664"><a href="#cb11-664" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2009 - "</span>,</span>
<span id="cb11-665"><a href="#cb11-665" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_09),</span>
<span id="cb11-666"><a href="#cb11-666" aria-hidden="true" tabindex="-1"></a>                          <span class="st">" people"</span>), </span>
<span id="cb11-667"><a href="#cb11-667" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#ff0087"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-668"><a href="#cb11-668" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-669"><a href="#cb11-669" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-670"><a href="#cb11-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG_all, date <span class="sc">&gt;=</span> <span class="st">"2019-01-01"</span>),</span>
<span id="cb11-671"><a href="#cb11-671" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-672"><a href="#cb11-672" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_19,</span>
<span id="cb11-673"><a href="#cb11-673" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2019 - "</span>, </span>
<span id="cb11-674"><a href="#cb11-674" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_19), </span>
<span id="cb11-675"><a href="#cb11-675" aria-hidden="true" tabindex="-1"></a>                          <span class="st">" people"</span>), </span>
<span id="cb11-676"><a href="#cb11-676" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#009cee"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-677"><a href="#cb11-677" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-678"><a href="#cb11-678" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-679"><a href="#cb11-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG_all, date <span class="sc">&gt;=</span> <span class="st">"2021-01-01"</span>), </span>
<span id="cb11-680"><a href="#cb11-680" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-681"><a href="#cb11-681" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>predicted_count_21,</span>
<span id="cb11-682"><a href="#cb11-682" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"2021 - "</span>, </span>
<span id="cb11-683"><a href="#cb11-683" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">CRUKRoundingPerYear</span>(predictions_ENG_summary<span class="sc">$</span>predicted_count_21), </span>
<span id="cb11-684"><a href="#cb11-684" aria-hidden="true" tabindex="-1"></a>                          <span class="st">" people"</span>), </span>
<span id="cb11-685"><a href="#cb11-685" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#00007e"</span>, <span class="at">dash =</span> <span class="st">'dash'</span>), </span>
<span id="cb11-686"><a href="#cb11-686" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-687"><a href="#cb11-687" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-688"><a href="#cb11-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> <span class="fu">filter</span>(predictions_ENG_all, date <span class="sc">&gt;=</span> <span class="st">"2009-01-01"</span>), </span>
<span id="cb11-689"><a href="#cb11-689" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>date, </span>
<span id="cb11-690"><a href="#cb11-690" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span>count,</span>
<span id="cb11-691"><a href="#cb11-691" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">"Historical data"</span>), </span>
<span id="cb11-692"><a href="#cb11-692" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"#000000"</span>), </span>
<span id="cb11-693"><a href="#cb11-693" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb11-694"><a href="#cb11-694" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-695"><a href="#cb11-695" aria-hidden="true" tabindex="-1"></a><span class="co">#eng_graph &lt;- ggplotly(eng_graph) %&gt;%</span></span>
<span id="cb11-696"><a href="#cb11-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-697"><a href="#cb11-697" aria-hidden="true" tabindex="-1"></a>         <span class="at">toImageButtonOptions =</span> <span class="fu">list</span>(</span>
<span id="cb11-698"><a href="#cb11-698" aria-hidden="true" tabindex="-1"></a>           <span class="at">format =</span> <span class="st">"png"</span>,</span>
<span id="cb11-699"><a href="#cb11-699" aria-hidden="true" tabindex="-1"></a>           <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"England 62 day models"</span>),</span>
<span id="cb11-700"><a href="#cb11-700" aria-hidden="true" tabindex="-1"></a>           <span class="at">width =</span> <span class="dv">1400</span>,</span>
<span id="cb11-701"><a href="#cb11-701" aria-hidden="true" tabindex="-1"></a>           <span class="at">height =</span> <span class="dv">600</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-702"><a href="#cb11-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb11-703"><a href="#cb11-703" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb11-704"><a href="#cb11-704" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb11-705"><a href="#cb11-705" aria-hidden="true" tabindex="-1"></a>      <span class="at">orientation =</span> <span class="st">"h"</span>,</span>
<span id="cb11-706"><a href="#cb11-706" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb11-707"><a href="#cb11-707" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Model starting year and predicted number of patients over next parliamentary term"</span>,</span>
<span id="cb11-708"><a href="#cb11-708" aria-hidden="true" tabindex="-1"></a>                   <span class="at">font =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb11-709"><a href="#cb11-709" aria-hidden="true" tabindex="-1"></a>                   <span class="at">side =</span> <span class="st">"top"</span>),</span>
<span id="cb11-710"><a href="#cb11-710" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span>  <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>)</span>
<span id="cb11-711"><a href="#cb11-711" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-712"><a href="#cb11-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb11-713"><a href="#cb11-713" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Number of people"</span>, </span>
<span id="cb11-714"><a href="#cb11-714" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> T, </span>
<span id="cb11-715"><a href="#cb11-715" aria-hidden="true" tabindex="-1"></a>      <span class="at">zeroline =</span> T,</span>
<span id="cb11-716"><a href="#cb11-716" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickmode =</span> <span class="st">'auto'</span>,</span>
<span id="cb11-717"><a href="#cb11-717" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickformat =</span> <span class="st">'~s'</span>,</span>
<span id="cb11-718"><a href="#cb11-718" aria-hidden="true" tabindex="-1"></a>      <span class="at">nticks =</span> <span class="dv">5</span>,</span>
<span id="cb11-719"><a href="#cb11-719" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40000</span>),</span>
<span id="cb11-720"><a href="#cb11-720" aria-hidden="true" tabindex="-1"></a>      <span class="at">titlefont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb11-721"><a href="#cb11-721" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickfont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>)),</span>
<span id="cb11-722"><a href="#cb11-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb11-723"><a href="#cb11-723" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">""</span>, </span>
<span id="cb11-724"><a href="#cb11-724" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="st">"2010-01-01"</span>, <span class="st">"2030-01-01"</span>),</span>
<span id="cb11-725"><a href="#cb11-725" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickmode =</span> <span class="st">'auto'</span>,</span>
<span id="cb11-726"><a href="#cb11-726" aria-hidden="true" tabindex="-1"></a>      <span class="at">nticks =</span> <span class="dv">12</span>,</span>
<span id="cb11-727"><a href="#cb11-727" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> F, </span>
<span id="cb11-728"><a href="#cb11-728" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickfont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color=</span> <span class="st">"#000000"</span>, <span class="at">size=</span> <span class="dv">14</span>),</span>
<span id="cb11-729"><a href="#cb11-729" aria-hidden="true" tabindex="-1"></a>      <span class="at">titlefont =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Poppins"</span>, <span class="at">color =</span> <span class="st">"#000000"</span>, <span class="at">size =</span> <span class="dv">18</span>)),</span>
<span id="cb11-730"><a href="#cb11-730" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Number of people starting treatment on the 62-day pathway&lt;br&gt;&lt;sup&gt;England&lt;/sup&gt;"</span>, </span>
<span id="cb11-731"><a href="#cb11-731" aria-hidden="true" tabindex="-1"></a>                 <span class="at">font =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Progress Medium"</span>, </span>
<span id="cb11-732"><a href="#cb11-732" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"#000000"</span>,<span class="at">size =</span> <span class="dv">28</span>),</span>
<span id="cb11-733"><a href="#cb11-733" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xref =</span> <span class="st">'container'</span>,</span>
<span id="cb11-734"><a href="#cb11-734" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xanchor =</span> <span class="st">'left'</span>,</span>
<span id="cb11-735"><a href="#cb11-735" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> <span class="fl">0.01</span>),</span>
<span id="cb11-736"><a href="#cb11-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">t =</span> <span class="dv">75</span>, <span class="at">b =</span> <span class="dv">10</span>) <span class="co">#Set margin sizes with t, b, r, l. </span></span>
<span id="cb11-737"><a href="#cb11-737" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb11-738"><a href="#cb11-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-739"><a href="#cb11-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-740"><a href="#cb11-740" aria-hidden="true" tabindex="-1"></a><span class="fu">## What would I do differently?</span></span>
<span id="cb11-741"><a href="#cb11-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-742"><a href="#cb11-742" aria-hidden="true" tabindex="-1"></a>Initially I had started out using a poisson/quasi-poisson model approach with some adjustments (such as varying the number of natural splines). </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>